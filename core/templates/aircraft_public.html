<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ aircraft_tail }} - Shared View</title>
    <link rel="icon" type="image/png" href="{% static 'icon.png' %}">
    <link rel="stylesheet" href="https://unpkg.com/@patternfly/patternfly@5.3.1/patternfly.min.css">
    <link rel="stylesheet" href="{% static 'css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
</head>
<body>
    <!-- Simplified navbar for public view -->
    <header class="pf-v5-c-masthead">
        <div class="pf-v5-c-masthead__main">
            <span class="pf-v5-c-masthead__brand">Simple Aircraft Manager - Shared View</span>
        </div>
    </header>

    <main class="pf-v5-c-page__main" tabindex="-1">
        <section class="pf-v5-c-page__main-section">
            <div x-data="publicAircraftView('{{ share_token }}')">
                <!-- Shared View Banner -->
                <div class="pf-v5-c-alert pf-m-info pf-m-inline" style="margin-bottom: 1rem;">
                    <div class="pf-v5-c-alert__icon"><i class="fas fa-info-circle"></i></div>
                    <p class="pf-v5-c-alert__title">
                        You are viewing a shared, read-only view of <strong x-text="aircraft?.tail_number || '...'"></strong>.
                    </p>
                </div>

                <!-- Loading State -->
                <div x-show="loading" class="pf-v5-l-bullseye" style="min-height: 200px;">
                    <div class="pf-v5-c-spinner" role="progressbar">
                        <span class="pf-v5-c-spinner__clipper"></span>
                        <span class="pf-v5-c-spinner__lead-ball"></span>
                        <span class="pf-v5-c-spinner__tail-ball"></span>
                    </div>
                </div>

                <!-- Error State -->
                <div x-show="error" class="pf-v5-c-alert pf-m-danger" style="margin-bottom: 1rem;">
                    <p class="pf-v5-c-alert__title" x-text="error"></p>
                </div>

                <div x-show="!loading && !error">
                    <!-- Page Header -->
                    <div class="pf-v5-c-content" style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                            <div>
                                <h1 x-text="aircraft?.tail_number || ''"></h1>
                                <p>
                                    <span x-text="aircraft?.make"></span>
                                    <span x-text="aircraft?.model"></span>
                                    <template x-if="aircraft?.serial_number">
                                        <span> &mdash; S/N: <span x-text="aircraft?.serial_number"></span></span>
                                    </template>
                                </p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span :class="getAirworthinessClass(aircraft)" class="pf-v5-c-label">
                                    <span class="pf-v5-c-label__content" x-text="getAirworthinessText(aircraft)"></span>
                                </span>
                                <span class="pf-v5-c-label">
                                    <span class="pf-v5-c-label__content" x-text="formatHours(aircraft?.flight_time) + ' hrs'"></span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="pf-v5-c-tabs" style="margin-bottom: 1rem;">
                        <ul class="pf-v5-c-tabs__list">
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'overview' }">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'overview'">
                                    <span class="pf-v5-c-tabs__item-text">Overview</span>
                                </button>
                            </li>
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'components' }">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'components'">
                                    <span class="pf-v5-c-tabs__item-text">Components</span>
                                </button>
                            </li>
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'ads' }" x-show="hasAds">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'ads'">
                                    <span class="pf-v5-c-tabs__item-text">ADs</span>
                                </button>
                            </li>
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'inspections' }" x-show="hasInspections">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'inspections'">
                                    <span class="pf-v5-c-tabs__item-text">Inspections</span>
                                </button>
                            </li>
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'squawks' }">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'squawks'">
                                    <span class="pf-v5-c-tabs__item-text">Squawks</span>
                                </button>
                            </li>
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'oil' }" x-show="oilRecords.length > 0">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'oil'">
                                    <span class="pf-v5-c-tabs__item-text">Oil</span>
                                </button>
                            </li>
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'fuel' }" x-show="fuelRecords.length > 0">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'fuel'">
                                    <span class="pf-v5-c-tabs__item-text">Fuel</span>
                                </button>
                            </li>
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'logbook' }" x-show="hasLogbook">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'logbook'">
                                    <span class="pf-v5-c-tabs__item-text">Logbook</span>
                                </button>
                            </li>
                            <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'documents' }" x-show="hasDocuments">
                                <button class="pf-v5-c-tabs__link" @click="activeTab = 'documents'">
                                    <span class="pf-v5-c-tabs__item-text">Documents</span>
                                </button>
                            </li>
                        </ul>
                    </div>

                    <!-- Overview Tab -->
                    <div x-show="activeTab === 'overview'">
                        <!-- Aircraft Info -->
                        <div class="pf-v5-c-card" style="margin-bottom: 1rem;">
                            <div class="pf-v5-c-card__title"><h2 class="pf-v5-c-card__title-text">Aircraft Information</h2></div>
                            <div class="pf-v5-c-card__body">
                                <dl class="pf-v5-c-description-list pf-m-horizontal">
                                    <div class="pf-v5-c-description-list__group">
                                        <dt class="pf-v5-c-description-list__term"><span class="pf-v5-c-description-list__text">Tail Number</span></dt>
                                        <dd class="pf-v5-c-description-list__description"><span class="pf-v5-c-description-list__text" x-text="aircraft?.tail_number"></span></dd>
                                    </div>
                                    <div class="pf-v5-c-description-list__group">
                                        <dt class="pf-v5-c-description-list__term"><span class="pf-v5-c-description-list__text">Make / Model</span></dt>
                                        <dd class="pf-v5-c-description-list__description"><span class="pf-v5-c-description-list__text" x-text="(aircraft?.make || '') + ' ' + (aircraft?.model || '')"></span></dd>
                                    </div>
                                    <template x-if="aircraft?.serial_number">
                                        <div class="pf-v5-c-description-list__group">
                                            <dt class="pf-v5-c-description-list__term"><span class="pf-v5-c-description-list__text">Serial Number</span></dt>
                                            <dd class="pf-v5-c-description-list__description"><span class="pf-v5-c-description-list__text" x-text="aircraft?.serial_number"></span></dd>
                                        </div>
                                    </template>
                                    <div class="pf-v5-c-description-list__group">
                                        <dt class="pf-v5-c-description-list__term"><span class="pf-v5-c-description-list__text">Total Hours</span></dt>
                                        <dd class="pf-v5-c-description-list__description"><span class="pf-v5-c-description-list__text" x-text="formatHours(aircraft?.flight_time)"></span></dd>
                                    </div>
                                    <div class="pf-v5-c-description-list__group">
                                        <dt class="pf-v5-c-description-list__term"><span class="pf-v5-c-description-list__text">Status</span></dt>
                                        <dd class="pf-v5-c-description-list__description"><span class="pf-v5-c-description-list__text" x-text="aircraft?.status"></span></dd>
                                    </div>
                                    <template x-if="aircraft?.description">
                                        <div class="pf-v5-c-description-list__group">
                                            <dt class="pf-v5-c-description-list__term"><span class="pf-v5-c-description-list__text">Description</span></dt>
                                            <dd class="pf-v5-c-description-list__description"><span class="pf-v5-c-description-list__text" x-text="aircraft?.description"></span></dd>
                                        </div>
                                    </template>
                                </dl>
                            </div>
                        </div>

                        <!-- Active Squawks -->
                        <div class="pf-v5-c-card" style="margin-bottom: 1rem;" x-show="activeSquawks.length > 0">
                            <div class="pf-v5-c-card__title"><h2 class="pf-v5-c-card__title-text">Active Squawks</h2></div>
                            <div class="pf-v5-c-card__body">
                                <template x-for="squawk in activeSquawks" :key="squawk.id">
                                    <div class="pf-v5-c-card pf-m-flat" style="margin-bottom: 0.5rem; padding: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: start;">
                                            <div>
                                                <span :class="getSquawkPriorityClass(squawk.priority)" class="pf-v5-c-label" style="margin-right: 0.5rem;">
                                                    <span class="pf-v5-c-label__content" x-text="squawk.priority_display"></span>
                                                </span>
                                                <span x-text="squawk.issue_reported"></span>
                                            </div>
                                            <small x-text="formatDate(squawk.created_at)" style="white-space: nowrap; color: var(--pf-v5-global--Color--200);"></small>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="pf-v5-c-card" x-show="notes.length > 0">
                            <div class="pf-v5-c-card__title"><h2 class="pf-v5-c-card__title-text">Notes</h2></div>
                            <div class="pf-v5-c-card__body">
                                <template x-for="note in notes" :key="note.id">
                                    <div style="margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--pf-v5-global--BorderColor--100);">
                                        <p x-text="note.text"></p>
                                        <small style="color: var(--pf-v5-global--Color--200);">
                                            <span x-text="note.added_by_username || 'Unknown'"></span> &mdash;
                                            <span x-text="formatDate(note.added_timestamp)"></span>
                                        </small>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Components Tab -->
                    <div x-show="activeTab === 'components'">
                        <div class="pf-v5-c-card">
                            <div class="pf-v5-c-card__body">
                                <template x-if="components.length === 0">
                                    <p style="color: var(--pf-v5-global--Color--200);">No components tracked.</p>
                                </template>
                                <table class="pf-v5-c-table pf-m-compact" x-show="components.length > 0">
                                    <thead>
                                        <tr>
                                            <th>Component</th>
                                            <th>Status</th>
                                            <th>Hours in Service</th>
                                            <th>Hours Since Overhaul</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="comp in components" :key="comp.id">
                                            <tr>
                                                <td x-text="comp.component_type_name || comp.component_type?.name || 'Unknown'"></td>
                                                <td x-text="comp.status"></td>
                                                <td x-text="formatHours(comp.hours_in_service)"></td>
                                                <td x-text="formatHours(comp.hours_since_overhaul)"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ADs Tab -->
                    <div x-show="activeTab === 'ads'">
                        <div class="pf-v5-c-card">
                            <div class="pf-v5-c-card__body">
                                <table class="pf-v5-c-table pf-m-compact pf-m-grid-md">
                                    <thead>
                                        <tr>
                                            <th>AD</th>
                                            <th>Description</th>
                                            <th>Status</th>
                                            <th>Last Complied</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="ad in ads" :key="ad.id">
                                            <tr>
                                                <td x-text="ad.name"></td>
                                                <td x-text="ad.short_description"></td>
                                                <td>
                                                    <span class="pf-v5-c-label" :class="getAdStatusClass(ad)">
                                                        <span class="pf-v5-c-label__content" x-text="getAdStatusText(ad)"></span>
                                                    </span>
                                                </td>
                                                <td x-text="ad.latest_compliance ? formatDate(ad.latest_compliance.date_complied) : '-'"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Inspections Tab -->
                    <div x-show="activeTab === 'inspections'">
                        <div class="pf-v5-c-card">
                            <div class="pf-v5-c-card__body">
                                <table class="pf-v5-c-table pf-m-compact pf-m-grid-md">
                                    <thead>
                                        <tr>
                                            <th>Inspection</th>
                                            <th>Required</th>
                                            <th>Status</th>
                                            <th>Last Done</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="insp in inspections" :key="insp.id">
                                            <tr>
                                                <td x-text="insp.name"></td>
                                                <td x-text="insp.required ? 'Yes' : 'No'"></td>
                                                <td>
                                                    <span class="pf-v5-c-label" :class="getInspectionStatusClass(insp)">
                                                        <span class="pf-v5-c-label__content" x-text="getInspectionStatusText(insp)"></span>
                                                    </span>
                                                </td>
                                                <td x-text="insp.latest_record ? formatDate(insp.latest_record.date) : '-'"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Squawks Tab -->
                    <div x-show="activeTab === 'squawks'">
                        <div class="pf-v5-c-card">
                            <div class="pf-v5-c-card__body">
                                <template x-if="activeSquawks.length === 0">
                                    <p style="color: var(--pf-v5-global--Color--200);">No active squawks.</p>
                                </template>
                                <template x-for="squawk in activeSquawks" :key="squawk.id">
                                    <div class="pf-v5-c-card pf-m-flat" style="margin-bottom: 0.5rem; padding: 0.75rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: start;">
                                            <div>
                                                <span :class="getSquawkPriorityClass(squawk.priority)" class="pf-v5-c-label" style="margin-right: 0.5rem;">
                                                    <span class="pf-v5-c-label__content" x-text="squawk.priority_display"></span>
                                                </span>
                                                <span x-text="squawk.issue_reported"></span>
                                            </div>
                                            <small x-text="formatDate(squawk.created_at)" style="white-space: nowrap; color: var(--pf-v5-global--Color--200);"></small>
                                        </div>
                                        <template x-if="squawk.notes">
                                            <p style="margin-top: 0.5rem; color: var(--pf-v5-global--Color--200);" x-text="squawk.notes"></p>
                                        </template>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Oil Tab -->
                    <div x-show="activeTab === 'oil'">
                        <div class="pf-v5-c-card" style="margin-bottom: 1rem;">
                            <div class="pf-v5-c-card__title"><h2 class="pf-v5-c-card__title-text">Oil Consumption</h2></div>
                            <div class="pf-v5-c-card__body">
                                <template x-if="oilBurnRate()">
                                    <p style="margin-bottom: 1rem;">
                                        <strong>Avg consumption:</strong>
                                        <span x-text="oilBurnRate() + ' qt/hr'"></span>
                                    </p>
                                </template>
                                <table class="pf-v5-c-table pf-m-compact pf-m-grid-md">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Added (qt)</th>
                                            <th>Level After</th>
                                            <th>Flight Hours</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="rec in oilRecords" :key="rec.id">
                                            <tr>
                                                <td x-text="formatDate(rec.date)"></td>
                                                <td x-text="rec.quantity_added ?? '-'"></td>
                                                <td x-text="rec.level_after ?? '-'"></td>
                                                <td x-text="rec.flight_hours ? formatHours(rec.flight_hours) : '-'"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Fuel Tab -->
                    <div x-show="activeTab === 'fuel'">
                        <div class="pf-v5-c-card" style="margin-bottom: 1rem;">
                            <div class="pf-v5-c-card__title"><h2 class="pf-v5-c-card__title-text">Fuel Records</h2></div>
                            <div class="pf-v5-c-card__body">
                                <template x-if="fuelBurnRate()">
                                    <p style="margin-bottom: 1rem;">
                                        <strong>Avg burn rate:</strong>
                                        <span x-text="fuelBurnRate() + ' gal/hr'"></span>
                                    </p>
                                </template>
                                <table class="pf-v5-c-table pf-m-compact pf-m-grid-md">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Added (gal)</th>
                                            <th>Flight Hours</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="rec in fuelRecords" :key="rec.id">
                                            <tr>
                                                <td x-text="formatDate(rec.date)"></td>
                                                <td x-text="rec.quantity_added ?? '-'"></td>
                                                <td x-text="rec.flight_hours ? formatHours(rec.flight_hours) : '-'"></td>
                                                <td x-text="rec.notes || '-'"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Logbook Tab -->
                    <div x-show="activeTab === 'logbook'">
                        <div class="pf-v5-c-card">
                            <div class="pf-v5-c-card__title"><h2 class="pf-v5-c-card__title-text">Recent Logbook Entries</h2></div>
                            <div class="pf-v5-c-card__body">
                                <div class="pf-v5-l-stack pf-m-gutter">
                                    <template x-for="log in recentLogs" :key="log.id">
                                        <div class="pf-v5-c-card pf-m-flat" style="padding: 0.75rem;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                                                <span style="font-weight: 600;" x-text="formatDate(log.date)"></span>
                                                <span class="pf-v5-c-label pf-m-blue" x-text="log.entry_type || log.log_type"></span>
                                            </div>
                                            <p x-text="log.text"></p>
                                            <template x-if="log.aircraft_hours_at_entry">
                                                <small style="color: var(--pf-v5-global--Color--200);">
                                                    Hours: <span x-text="formatHours(log.aircraft_hours_at_entry)"></span>
                                                </small>
                                            </template>
                                            <template x-if="log.signoff_person">
                                                <small style="color: var(--pf-v5-global--Color--200); display: block;">
                                                    Signed by: <span x-text="log.signoff_person"></span>
                                                </small>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Tab -->
                    <div x-show="activeTab === 'documents'">
                        <!-- Collections -->
                        <template x-for="col in documentCollections" :key="col.id">
                            <div class="pf-v5-c-card" style="margin-bottom: 1rem;">
                                <div class="pf-v5-c-card__title">
                                    <h3 class="pf-v5-c-card__title-text" x-text="col.name"></h3>
                                </div>
                                <template x-if="col.description">
                                    <div class="pf-v5-c-card__body" style="padding-bottom: 0;">
                                        <p style="color: var(--pf-v5-global--Color--200);" x-text="col.description"></p>
                                    </div>
                                </template>
                                <div class="pf-v5-c-card__body">
                                    <template x-if="col.documents.length === 0">
                                        <p style="color: var(--pf-v5-global--Color--200);">No documents in this collection.</p>
                                    </template>
                                    <template x-for="doc in col.documents" :key="doc.id">
                                        <div style="padding: 0.5rem 0; border-bottom: 1px solid var(--pf-v5-global--BorderColor--100);">
                                            <strong x-text="doc.name"></strong>
                                            <span class="pf-v5-c-label pf-m-compact pf-m-blue" style="margin-left: 0.5rem;" x-text="doc.doc_type_display"></span>
                                            <template x-if="doc.description">
                                                <p style="margin-top: 0.25rem; color: var(--pf-v5-global--Color--200);" x-text="doc.description"></p>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- Uncollected Documents -->
                        <template x-if="documents.length > 0">
                            <div class="pf-v5-c-card">
                                <div class="pf-v5-c-card__title"><h3 class="pf-v5-c-card__title-text">Other Documents</h3></div>
                                <div class="pf-v5-c-card__body">
                                    <template x-for="doc in documents" :key="doc.id">
                                        <div style="padding: 0.5rem 0; border-bottom: 1px solid var(--pf-v5-global--BorderColor--100);">
                                            <strong x-text="doc.name"></strong>
                                            <span class="pf-v5-c-label pf-m-compact pf-m-blue" style="margin-left: 0.5rem;" x-text="doc.doc_type_display"></span>
                                            <template x-if="doc.description">
                                                <p style="margin-top: 0.25rem; color: var(--pf-v5-global--Color--200);" x-text="doc.description"></p>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Utilities -->
    <script src="{% static 'js/utils.js' %}"></script>
    <script src="{% static 'js/aircraft-public.js' %}"></script>
</body>
</html>
