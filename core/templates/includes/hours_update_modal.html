<div x-data="hoursUpdateModal()" @open-hours-modal.window="open($event.detail.aircraft)" x-cloak>
    <div class="pf-v5-c-backdrop" x-show="isOpen" @click.self="close">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop>
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="close" style="position: absolute; top: 1rem; right: 1rem;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title">Update Aircraft Hours</h1>
                    <div class="pf-v5-c-modal-box__description" x-show="aircraft">
                        <span x-text="aircraft?.tail_number"></span>
                    </div>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submit">
                        <div class="pf-v5-c-form">
                            <!-- Current Tach Reading (Read-only) -->
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label">
                                    <span class="pf-v5-c-form__label-text">Current Tach Reading:</span>
                                </label>
                                <p class="pf-v5-u-font-size-2xl pf-v5-u-font-weight-bold" x-text="currentTachReading"></p>
                            </div>

                            <!-- New Tach Reading (meter value) -->
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="new-tach">
                                    <span class="pf-v5-c-form__label-text">New Tach Reading:</span>
                                    <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                                </label>
                                <input type="number"
                                       id="new-tach"
                                       class="pf-v5-c-form-control"
                                       x-model.number="newTachReading"
                                       step="0.1"
                                       min="0"
                                       required>
                            </div>

                            <!-- Hours Change (Calculated) -->
                            <div class="pf-v5-c-form__group" x-show="hoursChange !== null">
                                <label class="pf-v5-c-form__label">
                                    <span class="pf-v5-c-form__label-text" x-text="isCorrection ? 'Hours Removed (Correction):' : 'Hours Added:'"></span>
                                </label>
                                <p class="pf-v5-u-font-size-xl pf-v5-u-font-weight-bold"
                                   :class="isCorrection ? 'pf-v5-u-warning-color-100' : 'pf-v5-u-success-color-100'"
                                   x-text="isCorrection ? hoursChange : `+${hoursChange}`"></p>
                            </div>

                            <!-- Correction warning -->
                            <div class="pf-v5-c-alert pf-m-warning pf-m-inline" role="alert" x-show="isCorrection" x-cloak>
                                <div class="pf-v5-c-alert__icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="pf-v5-c-alert__description">
                                    This is a backwards correction. Component hours will be reduced (clamped at 0).
                                </div>
                            </div>

                            <!-- Hobbs Time (optional) -->
                            <div class="pf-v5-c-form__group" x-show="currentHobbsTime > 0 || newHobbsReading > 0">
                                <label class="pf-v5-c-form__label" for="new-hobbs">
                                    <span class="pf-v5-c-form__label-text">Hobbs Reading (optional):</span>
                                </label>
                                <input type="number"
                                       id="new-hobbs"
                                       class="pf-v5-c-form-control"
                                       x-model.number="newHobbsReading"
                                       step="0.1"
                                       min="0">
                            </div>

                            <!-- Info: Components auto-update -->
                            <div class="pf-v5-c-alert pf-m-info pf-m-inline" role="alert">
                                <div class="pf-v5-c-alert__icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="pf-v5-c-alert__description">
                                    All in-service components will be automatically updated with these hours.
                                </div>
                            </div>

                            <!-- Error message -->
                            <div class="pf-v5-c-alert pf-m-danger pf-m-inline" role="alert" x-show="errorMessage" x-cloak>
                                <div class="pf-v5-c-alert__icon">
                                    <i class="fas fa-exclamation-circle"></i>
                                </div>
                                <div class="pf-v5-c-alert__description" x-text="errorMessage"></div>
                            </div>
                        </div>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary"
                            @click="submit"
                            :disabled="submitting || !canSubmit">
                        <span x-show="!submitting">Update Hours</span>
                        <span x-show="submitting">
                            <span class="loading-spinner"></span>
                            Updating...
                        </span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link"
                            @click="close"
                            :disabled="submitting">
                        Cancel
                    </button>
                </footer>
            </div>
        </div>
    </div>
</div>
