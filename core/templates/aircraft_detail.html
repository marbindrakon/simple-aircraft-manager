{% extends "base.html" %}
{% load static %}

{% block content %}
<div x-data="aircraftDetail('{{ aircraft_id }}')" @aircraft-updated.window="loadData()">
    <!-- Page Header -->
    <div class="pf-v5-c-page__main-section pf-m-light">
        <div class="pf-v5-c-content">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div>
                        <h1 x-text="aircraft?.tail_number || 'Loading...'"></h1>
                        <p x-show="aircraft">
                            <span x-text="aircraft?.make"></span>
                            <span x-text="aircraft?.model"></span>
                        </p>
                    </div>
                    <!-- Airworthiness Status Badge -->
                    <div x-show="aircraft" x-cloak
                         class="airworthiness-badge"
                         :class="getAirworthinessClass()"
                         :title="getAirworthinessTooltip()">
                        <span class="status-icon">
                            <template x-if="aircraft?.airworthiness?.status === 'GREEN'">
                                <i class="fas fa-check-circle"></i>
                            </template>
                            <template x-if="aircraft?.airworthiness?.status === 'ORANGE'">
                                <i class="fas fa-exclamation-triangle"></i>
                            </template>
                            <template x-if="aircraft?.airworthiness?.status === 'RED'">
                                <i class="fas fa-times-circle"></i>
                            </template>
                        </span>
                        <span class="status-text" x-text="getAirworthinessText()"></span>
                    </div>
                    <!-- Current Hours -->
                    <div x-show="aircraft" x-cloak style="display: flex; align-items: baseline; gap: 0.4rem; margin-left: 0.5rem; color: var(--pf-v5-global--Color--200);">
                        <span style="font-size: 0.85rem;">Current Hours</span>
                        <span class="hours-display" style="font-size: 1.25rem;" x-text="formatHours(aircraft?.flight_time)"></span>
                    </div>
                </div>
                <div x-show="aircraft" x-cloak style="display: flex; gap: 0.5rem;">
                    <button class="pf-v5-c-button pf-m-primary"
                            @click="openHoursModal()"
                            :disabled="aircraft?.airworthiness?.status === 'RED'">
                        Update Hours
                    </button>
                    <button class="pf-v5-c-button pf-m-secondary"
                            @click="openEditModal()">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="pf-v5-c-button pf-m-danger"
                            @click="openDeleteModal()">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div class="pf-v5-c-page__main-section" x-show="loading" x-cloak>
        <div class="pf-v5-c-empty-state">
            <div class="pf-v5-c-empty-state__content">
                <div class="loading-spinner" style="width: 3rem; height: 3rem;"></div>
                <h2 class="pf-v5-c-title pf-m-lg">Loading aircraft data...</h2>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="pf-v5-c-page__main-section" x-show="!loading && aircraft" x-cloak>
        <div class="pf-v5-c-tabs" role="region">
            <ul class="pf-v5-c-tabs__list">
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'overview' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'overview'">
                        <span class="pf-v5-c-tabs__item-text">Overview</span>
                    </button>
                </li>
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'components' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'components'">
                        <span class="pf-v5-c-tabs__item-text">Components</span>
                    </button>
                </li>
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'logbook' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'logbook'">
                        <span class="pf-v5-c-tabs__item-text">Logbook</span>
                    </button>
                </li>
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'squawks' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'squawks'">
                        <span class="pf-v5-c-tabs__item-text">Squawks</span>
                        <template x-if="activeSquawks.length > 0">
                            <span class="pf-v5-c-badge pf-m-unread" style="margin-left: 0.5rem;" x-text="activeSquawks.length"></span>
                        </template>
                    </button>
                </li>
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'ads' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'ads'">
                        <span class="pf-v5-c-tabs__item-text">ADs</span>
                        <template x-if="adIssueCount > 0">
                            <span class="pf-v5-c-badge pf-m-unread" style="margin-left: 0.5rem;" x-text="adIssueCount"></span>
                        </template>
                    </button>
                </li>
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'inspections' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'inspections'">
                        <span class="pf-v5-c-tabs__item-text">Inspections</span>
                        <template x-if="inspectionIssueCount > 0">
                            <span class="pf-v5-c-badge pf-m-unread" style="margin-left: 0.5rem;" x-text="inspectionIssueCount"></span>
                        </template>
                    </button>
                </li>
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'oil' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'oil'">
                        <span class="pf-v5-c-tabs__item-text">Oil</span>
                    </button>
                </li>
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'fuel' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'fuel'">
                        <span class="pf-v5-c-tabs__item-text">Fuel</span>
                    </button>
                </li>
                <li class="pf-v5-c-tabs__item" :class="{ 'pf-m-current': activeTab === 'documents' }">
                    <button class="pf-v5-c-tabs__link" @click="activeTab = 'documents'">
                        <span class="pf-v5-c-tabs__item-text">Documents</span>
                    </button>
                </li>
            </ul>
        </div>

        <!-- Overview Tab -->
        <div x-show="activeTab === 'overview'" class="pf-v5-c-page__main-section">
            <div class="pf-l-gallery pf-m-gutter">
                <!-- Aircraft Info Card -->
                <div class="pf-v5-c-card">
                    <div class="pf-v5-c-card__title">
                        <h2>Aircraft Information</h2>
                    </div>
                    <div class="pf-v5-c-card__body">
                        <div class="aircraft-info-container">
                            <!-- Aircraft Image -->
                            <div x-show="aircraft?.picture" class="aircraft-image">
                                <img :src="aircraft?.picture"
                                     :alt="aircraft?.tail_number + ' photo'">
                            </div>
                            <!-- Aircraft Details -->
                            <div class="aircraft-details">
                                <dl>
                                    <dt>Tail Number:</dt>
                                    <dd x-text="aircraft?.tail_number"></dd>
                                    <dt>Make:</dt>
                                    <dd x-text="aircraft?.make"></dd>
                                    <dt>Model:</dt>
                                    <dd x-text="aircraft?.model"></dd>
                                    <dt>Status:</dt>
                                    <dd>
                                        <span class="pf-v5-c-label pf-m-blue" x-text="aircraft?.status"></span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes Card -->
                <div class="pf-v5-c-card">
                    <div class="pf-v5-c-card__header">
                        <div class="pf-v5-c-card__header-main">
                            <div class="pf-v5-c-card__title">
                                <h2>Notes</h2>
                            </div>
                        </div>
                        <div class="pf-v5-c-card__actions">
                            <button class="pf-v5-c-button pf-m-plain" @click="openNoteModal()" title="Add Note">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="pf-v5-c-card__body">
                        <template x-if="aircraftNotes.length === 0">
                            <p style="color: var(--pf-v5-global--Color--200);">No notes yet</p>
                        </template>
                        <template x-if="aircraftNotes.length > 0">
                            <div class="notes-list">
                                <template x-for="note in aircraftNotes.slice(0, 3)" :key="note.id">
                                    <div class="note-item" @click="editNote(note)">
                                        <p class="note-text" x-text="note.text"></p>
                                        <div class="note-meta">
                                            <span x-text="formatDate(note.added_timestamp)"></span>
                                            <template x-if="note.added_by_username">
                                                <span> - <span x-text="note.added_by_username"></span></span>
                                            </template>
                                            <template x-if="note.edited_timestamp">
                                                <span class="note-edited">(edited)</span>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                                <template x-if="aircraftNotes.length > 3">
                                    <p style="text-align: center; margin-top: 0.5rem;">
                                        <a href="#" @click.prevent="showAllNotes = true" class="pf-v5-c-button pf-m-link pf-m-inline">
                                            View all <span x-text="aircraftNotes.length"></span> notes
                                        </a>
                                    </p>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Recent Activity Card -->
                <div class="pf-v5-c-card">
                    <div class="pf-v5-c-card__header">
                        <div class="pf-v5-c-card__header-main">
                            <div class="pf-v5-c-card__title">
                                <h2>Recent Activity</h2>
                            </div>
                        </div>
                        <div class="pf-v5-c-card__actions">
                            <button class="pf-v5-c-button pf-m-link pf-m-small" @click="openEventsHistory()">
                                View full history
                            </button>
                        </div>
                    </div>
                    <div class="pf-v5-c-card__body">
                        <template x-if="!eventsLoaded">
                            <div style="text-align: center; padding: 1rem;">
                                <span class="pf-v5-c-spinner pf-m-md" role="progressbar">
                                    <span class="pf-v5-c-spinner__clipper"></span>
                                    <span class="pf-v5-c-spinner__lead-ball"></span>
                                    <span class="pf-v5-c-spinner__tail-ball"></span>
                                </span>
                            </div>
                        </template>
                        <template x-if="eventsLoaded && recentEvents.length === 0">
                            <p style="color: var(--pf-v5-global--Color--200); text-align: center; padding: 1rem;">
                                No activity recorded yet.
                            </p>
                        </template>
                        <template x-if="eventsLoaded && recentEvents.length > 0">
                            <div>
                                <template x-for="event in recentEvents" :key="event.id">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.35rem 0; border-bottom: 1px solid var(--pf-v5-global--BorderColor--100); font-size: 0.85em;">
                                        <span class="pf-v5-c-label pf-m-compact" :class="eventCategoryClass(event.category)">
                                            <span class="pf-v5-c-label__content" x-text="eventCategoryLabel(event.category)"></span>
                                        </span>
                                        <span x-text="event.event_name" style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></span>
                                        <span style="color: var(--pf-v5-global--Color--200); white-space: nowrap;" x-text="formatEventTime(event.timestamp)"></span>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Airworthiness Issues Section -->
            <template x-if="aircraft?.airworthiness?.issue_count > 0">
                <div class="pf-v5-c-card" style="margin-top: 1.5rem;"
                     :class="{ 'card-border-red': aircraft?.airworthiness?.status === 'RED', 'card-border-orange': aircraft?.airworthiness?.status === 'ORANGE' }">
                    <div class="pf-v5-c-card__header">
                        <div class="pf-v5-c-card__header-main">
                            <div class="pf-v5-c-card__title">
                                <h2>Airworthiness Issues</h2>
                            </div>
                        </div>
                        <div class="pf-v5-c-card__actions">
                            <template x-if="aircraft?.airworthiness?.red_count > 0">
                                <span class="pf-v5-c-label pf-m-red">
                                    <span x-text="aircraft.airworthiness.red_count"></span> Grounding
                                </span>
                            </template>
                            <template x-if="aircraft?.airworthiness?.orange_count > 0">
                                <span class="pf-v5-c-label pf-m-orange" style="margin-left: 0.5rem;">
                                    <span x-text="aircraft.airworthiness.orange_count"></span> Upcoming
                                </span>
                            </template>
                        </div>
                    </div>
                    <div class="pf-v5-c-card__body">
                        <div class="airworthiness-issues">
                            <template x-for="issue in aircraft?.airworthiness?.issues || []" :key="issue.item_id">
                                <div class="issue-item" :class="'issue-severity-' + issue.severity.toLowerCase()">
                                    <div class="issue-icon" :class="'icon-' + issue.severity.toLowerCase()">
                                        <template x-if="issue.severity === 'RED'">
                                            <i class="fas fa-times-circle"></i>
                                        </template>
                                        <template x-if="issue.severity === 'ORANGE'">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </template>
                                    </div>
                                    <div class="issue-content">
                                        <div class="issue-category" x-text="issue.category"></div>
                                        <div class="issue-title" x-text="issue.title"></div>
                                        <div class="issue-description" x-text="issue.description"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </template>

        </div>

        <!-- Events History Modal -->
        <template x-if="eventsHistoryOpen">
            <div class="pf-v5-c-backdrop">
                <div class="pf-v5-c-modal-box pf-m-lg" role="dialog" aria-modal="true" aria-label="Activity History">
                    <div class="pf-v5-c-modal-box__close">
                        <button class="pf-v5-c-button pf-m-plain" @click="closeEventsHistory()" aria-label="Close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <header class="pf-v5-c-modal-box__header">
                        <h1 class="pf-v5-c-modal-box__title">Activity History</h1>
                    </header>
                    <div class="pf-v5-c-modal-box__body" style="max-height: 60vh; overflow-y: auto;">
                        <div style="margin-bottom: 1rem;">
                            <select class="pf-v5-c-form-control"
                                    x-model="eventsHistoryCategory"
                                    @change="loadEventsHistory()"
                                    style="max-width: 200px;">
                                <option value="">All Categories</option>
                                <option value="hours">Hours</option>
                                <option value="component">Component</option>
                                <option value="squawk">Squawk</option>
                                <option value="note">Note</option>
                                <option value="oil">Oil</option>
                                <option value="fuel">Fuel</option>
                                <option value="logbook">Logbook</option>
                                <option value="ad">AD</option>
                                <option value="inspection">Inspection</option>
                                <option value="document">Document</option>
                            </select>
                            <span style="margin-left: 0.75rem; color: var(--pf-v5-global--Color--200);">
                                <span x-text="eventsHistoryTotal"></span> total events
                            </span>
                        </div>

                        <template x-if="eventsHistoryLoading">
                            <div style="text-align: center; padding: 2rem;">
                                <span class="pf-v5-c-spinner pf-m-lg" role="progressbar">
                                    <span class="pf-v5-c-spinner__clipper"></span>
                                    <span class="pf-v5-c-spinner__lead-ball"></span>
                                    <span class="pf-v5-c-spinner__tail-ball"></span>
                                </span>
                            </div>
                        </template>
                        <template x-if="!eventsHistoryLoading && eventsHistoryAll.length === 0">
                            <p style="text-align: center; padding: 2rem; color: var(--pf-v5-global--Color--200);">
                                No events found.
                            </p>
                        </template>
                        <template x-if="!eventsHistoryLoading && eventsHistoryAll.length > 0">
                            <div class="pf-v5-c-data-list" role="list">
                                <template x-for="event in eventsHistoryAll" :key="event.id">
                                    <div class="pf-v5-c-data-list__item" role="listitem">
                                        <div class="pf-v5-c-data-list__item-row" style="padding: 0.5rem 0;">
                                            <div class="pf-v5-c-data-list__item-content" style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                                                <span class="pf-v5-c-label pf-m-compact" :class="eventCategoryClass(event.category)">
                                                    <span class="pf-v5-c-label__content" x-text="eventCategoryLabel(event.category)"></span>
                                                </span>
                                                <span x-text="event.event_name" style="flex: 1;"></span>
                                                <span x-show="event.user_display" style="color: var(--pf-v5-global--Color--200); font-size: 0.85em;" x-text="event.user_display"></span>
                                                <span style="color: var(--pf-v5-global--Color--200); font-size: 0.85em; white-space: nowrap;" x-text="formatEventTime(event.timestamp)"></span>
                                            </div>
                                            <template x-if="event.notes">
                                                <div style="padding-left: 5.5rem; color: var(--pf-v5-global--Color--200); font-size: 0.85em;" x-text="event.notes"></div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                    <footer class="pf-v5-c-modal-box__footer">
                        <button class="pf-v5-c-button pf-m-link" @click="closeEventsHistory()">Close</button>
                    </footer>
                </div>
            </div>
        </template>

        <!-- Components Tab -->
        <div x-show="activeTab === 'components'" class="pf-v5-c-page__main-section">
            <!-- Header with Add Button -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Components</h2>
                <button class="pf-v5-c-button pf-m-primary" @click="openComponentModal()">
                    <i class="fas fa-plus"></i> Add Component
                </button>
            </div>

            <table class="pf-v5-c-table pf-m-grid-md">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Manufacturer/Model</th>
                        <th>Location</th>
                        <th>Hours</th>
                        <th>Interval</th>
                        <th>Remaining</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-if="components.length === 0">
                        <tr>
                            <td colspan="8" style="text-align: center;">No components found</td>
                        </tr>
                    </template>
                    <template x-for="component in sortedComponents" :key="component.id">
                        <tr>
                            <td>
                                <span :style="'padding-left: ' + (getComponentDepth(component) * 1.5) + 'rem'">
                                    <template x-if="getComponentDepth(component) > 0">
                                        <i class="fas fa-level-up-alt fa-rotate-90" style="color: var(--pf-v5-global--Color--200); margin-right: 0.25rem; font-size: 0.75rem;"></i>
                                    </template>
                                    <span x-text="getComponentTypeName(component)"></span>
                                </span>
                                <template x-if="component.replacement_critical">
                                    <span class="pf-v5-c-label pf-m-compact pf-m-purple" style="margin-left: 0.25rem;" title="Replacement item">
                                        <i class="fas fa-sync-alt"></i>
                                    </span>
                                </template>
                            </td>
                            <td x-text="`${component.manufacturer} ${component.model}`"></td>
                            <td x-text="component.install_location"></td>
                            <td x-text="formatHours(getComponentCurrentHours(component))"></td>
                            <td x-text="getComponentInterval(component)"></td>
                            <td :class="getHoursRemainingClass(component)" x-text="calculateHoursRemaining(component)"></td>
                            <td>
                                <span class="pf-v5-c-label"
                                      :class="getStatusClass(component)"
                                      x-text="component.status"></span>
                            </td>
                            <td>
                                <div style="display: flex; gap: 0.25rem;">
                                    <button class="pf-v5-c-button pf-m-plain"
                                            @click="editComponent(component)"
                                            title="Edit component">
                                        <i class="fas fa-pencil-alt"></i>
                                    </button>
                                    <template x-if="component.replacement_critical && component.status === 'IN-USE'">
                                        <button class="pf-v5-c-button pf-m-plain"
                                                @click="resetComponentService(component)"
                                                :title="'Reset ' + getComponentTypeName(component) + ' service time'">
                                            <i class="fas fa-redo"></i>
                                        </button>
                                    </template>
                                    <button class="pf-v5-c-button pf-m-plain pf-m-danger"
                                            @click="deleteComponent(component)"
                                            title="Delete component">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Logbook Tab -->
        <div x-show="activeTab === 'logbook'" class="pf-v5-c-page__main-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Maintenance Logbook</h2>
                <button class="pf-v5-c-button pf-m-primary" @click="openLogbookModal()">
                    <i class="fas fa-plus"></i> New Entry
                </button>
            </div>

            <!-- Loading -->
            <div x-show="!logbookLoaded" class="pf-v5-c-empty-state">
                <div class="pf-v5-c-empty-state__content">
                    <div class="loading-spinner" style="width: 2rem; height: 2rem;"></div>
                    <h2 class="pf-v5-c-title pf-m-lg">Loading logbook...</h2>
                </div>
            </div>

            <div x-show="logbookLoaded" x-cloak>
                <template x-if="logbookEntries.length === 0">
                    <div class="pf-v5-c-empty-state">
                        <div class="pf-v5-c-empty-state__content">
                            <i class="fas fa-book" style="font-size: 3rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                            <h2 class="pf-v5-c-title pf-m-lg">No logbook entries</h2>
                            <div class="pf-v5-c-empty-state__body">
                                No maintenance entries have been recorded yet.
                            </div>
                        </div>
                    </div>
                </template>
                <template x-if="logbookEntries.length > 0">
                    <div class="pf-v5-l-stack pf-m-gutter">
                        <template x-for="log in logbookEntries" :key="log.id">
                            <div class="pf-v5-c-card" :id="`log-entry-${log.id}`">
                                <div class="pf-v5-c-card__header">
                                    <div class="pf-v5-c-card__header-main">
                                        <div class="pf-v5-c-card__title">
                                            <span x-text="formatDate(log.date)" style="font-weight: 600;"></span>
                                            <span class="pf-v5-c-label pf-m-blue" style="margin-left: 0.5rem;" x-text="log.entry_type || log.log_type"></span>
                                        </div>
                                    </div>
                                    <div class="pf-v5-c-card__actions">
                                        <button class="pf-v5-c-button pf-m-plain" @click="editLogEntry(log)" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="pf-v5-c-button pf-m-plain pf-m-danger" @click="deleteLogEntry(log)" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="pf-v5-c-card__body">
                                    <p x-text="log.text"></p>
                                    <template x-if="log.aircraft_hours_at_entry">
                                        <p style="margin-top: 0.5rem;">
                                            <strong>Aircraft Hours:</strong>
                                            <span x-text="formatHours(log.aircraft_hours_at_entry)"></span>
                                        </p>
                                    </template>
                                    <template x-if="log.signoff_person">
                                        <p style="margin-top: 0.5rem;">
                                            <strong>Signed by:</strong>
                                            <span x-text="log.signoff_person"></span>
                                            <template x-if="log.signoff_location">
                                                <span> at <span x-text="log.signoff_location"></span></span>
                                            </template>
                                        </p>
                                    </template>
                                    <template x-if="log.log_image">
                                        <p style="margin-top: 0.5rem;">
                                            <i class="fas fa-paperclip" style="color: var(--pf-v5-global--Color--200);"></i>
                                            <button class="pf-v5-c-button pf-m-link pf-m-inline"
                                                    @click="viewLogEntryDocument(log)"
                                                    style="font-size: inherit;">
                                                View attached document
                                            </button>
                                        </p>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>

        <!-- Squawks Tab -->
        <div x-show="activeTab === 'squawks'" class="pf-v5-c-page__main-section">
            <!-- Header with Add Button -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Active Squawks</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <a :href="`/aircraft/${aircraftId}/squawks/history/`" class="pf-v5-c-button pf-m-secondary">
                        <i class="fas fa-history"></i> View History
                    </a>
                    <button class="pf-v5-c-button pf-m-primary" @click="openSquawkModal()">
                        <i class="fas fa-plus"></i> New Squawk
                    </button>
                </div>
            </div>

            <!-- Empty State -->
            <template x-if="activeSquawks.length === 0">
                <div class="pf-v5-c-empty-state">
                    <div class="pf-v5-c-empty-state__content">
                        <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--pf-v5-global--success-color--100);"></i>
                        <h2 class="pf-v5-c-title pf-m-lg">No Active Squawks</h2>
                        <div class="pf-v5-c-empty-state__body">
                            This aircraft has no open maintenance issues.
                        </div>
                    </div>
                </div>
            </template>

            <!-- Squawk List -->
            <div class="pf-v5-l-stack pf-m-gutter" x-show="activeSquawks.length > 0">
                <template x-for="squawk in activeSquawks" :key="squawk.id">
                    <div class="pf-v5-c-card squawk-card" :class="getSquawkCardClass(squawk)">
                        <div class="pf-v5-c-card__header">
                            <div class="pf-v5-c-card__header-main">
                                <div class="pf-v5-c-card__title">
                                    <span class="pf-v5-c-label" :class="getSquawkPriorityClass(squawk)" x-text="squawk.priority_display"></span>
                                    <template x-if="squawk.component_name">
                                        <span class="pf-v5-c-label pf-m-blue" style="margin-left: 0.5rem;" x-text="squawk.component_name"></span>
                                    </template>
                                </div>
                            </div>
                            <div class="pf-v5-c-card__actions">
                                <button class="pf-v5-c-button pf-m-plain" @click="editSquawk(squawk)" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="pf-v5-c-button pf-m-plain pf-m-success" @click="resolveSquawk(squawk)" title="Mark Resolved">
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                        </div>
                        <div class="pf-v5-c-card__body">
                            <p x-text="squawk.issue_reported"></p>
                            <template x-if="squawk.notes">
                                <p style="margin-top: 0.5rem; color: var(--pf-v5-global--Color--200);">
                                    <strong>Notes:</strong> <span x-text="squawk.notes"></span>
                                </p>
                            </template>
                        </div>
                        <div class="pf-v5-c-card__footer" style="font-size: 0.875rem; color: var(--pf-v5-global--Color--200);">
                            <span>Reported <span x-text="formatDateTime(squawk.created_at)"></span></span>
                            <template x-if="squawk.reported_by_username">
                                <span> by <span x-text="squawk.reported_by_username"></span></span>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- ADs Tab -->
        <div x-show="activeTab === 'ads'" class="pf-v5-c-page__main-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Airworthiness Directives</h2>
                <button class="pf-v5-c-button pf-m-primary" @click="openAdModal()">
                    <i class="fas fa-plus"></i> Add AD
                </button>
            </div>

            <!-- Loading -->
            <div x-show="!adsLoaded" class="pf-v5-c-empty-state">
                <div class="pf-v5-c-empty-state__content">
                    <div class="loading-spinner" style="width: 2rem; height: 2rem;"></div>
                    <h2 class="pf-v5-c-title pf-m-lg">Loading ADs...</h2>
                </div>
            </div>

            <div x-show="adsLoaded" x-cloak>
                <!-- Empty State -->
                <template x-if="applicableAds.length === 0">
                    <div class="pf-v5-c-empty-state">
                        <div class="pf-v5-c-empty-state__content">
                            <i class="fas fa-clipboard-check" style="font-size: 3rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                            <h2 class="pf-v5-c-title pf-m-lg">No Applicable ADs</h2>
                            <div class="pf-v5-c-empty-state__body">
                                No Airworthiness Directives are currently tracked for this aircraft.
                            </div>
                        </div>
                    </div>
                </template>

                <!-- AD Table -->
                <template x-if="applicableAds.length > 0">
                    <table class="pf-v5-c-table pf-m-grid-md">
                        <thead>
                            <tr>
                                <th>AD Name</th>
                                <th>Description</th>
                                <th>Recurring</th>
                                <th>Status</th>
                                <th>Last Complied</th>
                                <th>Next Due</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="ad in applicableAds" :key="ad.id">
                                <tr>
                                    <td x-text="ad.name"></td>
                                    <td>
                                        <span x-text="ad.short_description"></span>
                                        <template x-if="ad.compliance_type === 'conditional' && ad.trigger_condition">
                                            <div style="font-size: 0.85em; color: var(--pf-v5-global--Color--200); margin-top: 0.25rem;">
                                                Trigger: <span x-text="ad.trigger_condition"></span>
                                            </div>
                                        </template>
                                    </td>
                                    <td>
                                        <template x-if="ad.recurring">
                                            <span>
                                                Yes
                                                <template x-if="ad.recurring_hours > 0">
                                                    <span x-text="'(' + ad.recurring_hours + ' hrs)'"></span>
                                                </template>
                                                <template x-if="ad.recurring_months > 0">
                                                    <span x-text="'(' + ad.recurring_months + ' mo)'"></span>
                                                </template>
                                            </span>
                                        </template>
                                        <template x-if="!ad.recurring">
                                            <span>No</span>
                                        </template>
                                    </td>
                                    <td>
                                        <span class="pf-v5-c-label" :class="getAdStatusClass(ad)" x-text="getAdStatusText(ad)"></span>
                                    </td>
                                    <td x-text="ad.latest_compliance ? formatDate(ad.latest_compliance.date_complied) : '-'"></td>
                                    <td>
                                        <template x-if="ad.latest_compliance && ad.latest_compliance.permanent">
                                            <span>Permanent</span>
                                        </template>
                                        <template x-if="ad.latest_compliance && !ad.latest_compliance.permanent && ad.next_due_date_display">
                                            <span x-text="'End of ' + ad.next_due_date_display"></span>
                                        </template>
                                        <template x-if="ad.latest_compliance && !ad.latest_compliance.permanent && !ad.next_due_date_display && ad.latest_compliance.next_due_at_time > 0">
                                            <span x-text="formatHours(ad.latest_compliance.next_due_at_time) + ' hrs'"></span>
                                        </template>
                                        <template x-if="!ad.latest_compliance || (!ad.latest_compliance.permanent && !ad.next_due_date_display && (!ad.latest_compliance.next_due_at_time || ad.latest_compliance.next_due_at_time == 0))">
                                            <span>-</span>
                                        </template>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 0.25rem;">
                                            <button class="pf-v5-c-button pf-m-plain"
                                                    @click="editAd(ad)"
                                                    title="Edit AD"
                                                    aria-label="Edit AD">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="pf-v5-c-button pf-m-plain"
                                                    @click="openComplianceModal(ad)"
                                                    title="Record Compliance">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="pf-v5-c-button pf-m-plain"
                                                    @click="openComplianceHistory(ad)"
                                                    title="View Compliance History">
                                                <i class="fas fa-history"></i>
                                            </button>
                                            <button class="pf-v5-c-button pf-m-plain pf-m-danger"
                                                    @click="removeAd(ad)"
                                                    title="Remove AD">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </template>
            </div>
        </div>

        <!-- Inspections Tab -->
        <div x-show="activeTab === 'inspections'" class="pf-v5-c-page__main-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Inspections</h2>
                <button class="pf-v5-c-button pf-m-primary" @click="openInspectionTypeModal()">
                    <i class="fas fa-plus"></i> Add Inspection Type
                </button>
            </div>

            <!-- Loading -->
            <div x-show="!inspectionsLoaded" class="pf-v5-c-empty-state">
                <div class="pf-v5-c-empty-state__content">
                    <div class="loading-spinner" style="width: 2rem; height: 2rem;"></div>
                    <h2 class="pf-v5-c-title pf-m-lg">Loading inspections...</h2>
                </div>
            </div>

            <div x-show="inspectionsLoaded" x-cloak>
                <!-- Empty State -->
                <template x-if="inspectionTypes.length === 0">
                    <div class="pf-v5-c-empty-state">
                        <div class="pf-v5-c-empty-state__content">
                            <i class="fas fa-clipboard-check" style="font-size: 3rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                            <h2 class="pf-v5-c-title pf-m-lg">No Applicable Inspections</h2>
                            <div class="pf-v5-c-empty-state__body">
                                No inspection types are currently tracked for this aircraft.
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Inspection Types Table -->
                <template x-if="inspectionTypes.length > 0">
                    <table class="pf-v5-c-table pf-m-grid-md">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Recurring</th>
                                <th>Status</th>
                                <th>Last Completed</th>
                                <th>Next Due</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="insp in inspectionTypes" :key="insp.id">
                                <tr>
                                    <td x-text="insp.name"></td>
                                    <td>
                                        <template x-if="insp.recurring">
                                            <span>
                                                Yes
                                                <template x-if="insp.recurring_hours > 0">
                                                    <span x-text="'(' + insp.recurring_hours + ' hrs)'"></span>
                                                </template>
                                                <template x-if="insp.recurring_months > 0">
                                                    <span x-text="'(' + insp.recurring_months + ' mo)'"></span>
                                                </template>
                                                <template x-if="insp.recurring_days > 0 && insp.recurring_months === 0">
                                                    <span x-text="'(' + insp.recurring_days + ' days)'"></span>
                                                </template>
                                            </span>
                                        </template>
                                        <template x-if="!insp.recurring">
                                            <span>No</span>
                                        </template>
                                    </td>
                                    <td>
                                        <span class="pf-v5-c-label" :class="getInspectionStatusClass(insp)" x-text="getInspectionStatusText(insp)"></span>
                                    </td>
                                    <td x-text="insp.latest_record ? formatDate(insp.latest_record.date) : '-'"></td>
                                    <td>
                                        <template x-if="!insp.recurring || !insp.latest_record">
                                            <span>-</span>
                                        </template>
                                        <template x-if="insp.recurring && insp.latest_record && insp.next_due_date">
                                            <span x-text="formatDate(insp.next_due_date)"></span>
                                        </template>
                                        <template x-if="insp.recurring && insp.latest_record && insp.next_due_hours && !insp.next_due_date">
                                            <span x-text="formatHours(insp.next_due_hours) + ' hrs'"></span>
                                        </template>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 0.25rem;">
                                            <button class="pf-v5-c-button pf-m-plain"
                                                    @click="editInspectionType(insp)"
                                                    title="Edit Inspection Type"
                                                    aria-label="Edit Inspection Type">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="pf-v5-c-button pf-m-plain"
                                                    @click="openInspectionModal(insp)"
                                                    title="Record Inspection">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="pf-v5-c-button pf-m-plain"
                                                    @click="openInspectionHistory(insp)"
                                                    title="View Inspection History">
                                                <i class="fas fa-history"></i>
                                            </button>
                                            <button class="pf-v5-c-button pf-m-plain pf-m-danger"
                                                    @click="removeInspectionType(insp)"
                                                    title="Remove Inspection Type">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </template>
            </div>
        </div>

        <!-- Oil Tab -->
        <div x-show="activeTab === 'oil'" class="pf-v5-c-page__main-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Oil Consumption</h2>
                <button class="pf-v5-c-button pf-m-primary" @click="openOilModal()">
                    <i class="fas fa-plus"></i> Add Oil Record
                </button>
            </div>

            <!-- Loading -->
            <div x-show="!oilLoaded" class="pf-v5-c-empty-state">
                <div class="pf-v5-c-empty-state__content">
                    <div class="loading-spinner" style="width: 2rem; height: 2rem;"></div>
                    <h2 class="pf-v5-c-title pf-m-lg">Loading oil records...</h2>
                </div>
            </div>

            <div x-show="oilLoaded" x-cloak>
                <!-- Empty State -->
                <template x-if="oilRecords.length === 0">
                    <div class="pf-v5-c-empty-state">
                        <div class="pf-v5-c-empty-state__content">
                            <i class="fas fa-oil-can" style="font-size: 3rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                            <h2 class="pf-v5-c-title pf-m-lg">No oil records</h2>
                            <div class="pf-v5-c-empty-state__body">
                                Track oil consumption by adding records each time you add oil.
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Oil Chart -->
                <template x-if="oilRecords.length >= 2">
                    <div class="pf-v5-c-card" style="margin-bottom: 1rem;">
                        <div class="pf-v5-c-card__title"><h3>Oil Consumption Trend (Hours per Quart)</h3></div>
                        <div class="pf-v5-c-card__body">
                            <canvas id="oilChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </template>

                <!-- Oil Records Table -->
                <template x-if="oilRecords.length > 0">
                    <table class="pf-v5-c-table pf-m-grid-md">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Hours</th>
                                <th>Qty (qt)</th>
                                <th>Level After</th>
                                <th>Type</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="record in oilRecords" :key="record.id">
                                <tr>
                                    <td x-text="formatDate(record.date)"></td>
                                    <td x-text="formatHours(record.flight_hours)"></td>
                                    <td x-text="record.quantity_added"></td>
                                    <td x-text="record.level_after || '-'"></td>
                                    <td x-text="record.oil_type || '-'"></td>
                                    <td x-text="record.notes || '-'"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </template>
            </div>
        </div>

        <!-- Fuel Tab -->
        <div x-show="activeTab === 'fuel'" class="pf-v5-c-page__main-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Fuel Consumption</h2>
                <button class="pf-v5-c-button pf-m-primary" @click="openFuelModal()">
                    <i class="fas fa-plus"></i> Add Fuel Record
                </button>
            </div>

            <!-- Loading -->
            <div x-show="!fuelLoaded" class="pf-v5-c-empty-state">
                <div class="pf-v5-c-empty-state__content">
                    <div class="loading-spinner" style="width: 2rem; height: 2rem;"></div>
                    <h2 class="pf-v5-c-title pf-m-lg">Loading fuel records...</h2>
                </div>
            </div>

            <div x-show="fuelLoaded" x-cloak>
                <!-- Empty State -->
                <template x-if="fuelRecords.length === 0">
                    <div class="pf-v5-c-empty-state">
                        <div class="pf-v5-c-empty-state__content">
                            <i class="fas fa-gas-pump" style="font-size: 3rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                            <h2 class="pf-v5-c-title pf-m-lg">No fuel records</h2>
                            <div class="pf-v5-c-empty-state__body">
                                Track fuel consumption by adding records each time you refuel.
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Fuel Chart -->
                <template x-if="fuelRecords.length >= 2">
                    <div class="pf-v5-c-card" style="margin-bottom: 1rem;">
                        <div class="pf-v5-c-card__title"><h3>Fuel Consumption Trend (Gallons per Hour)</h3></div>
                        <div class="pf-v5-c-card__body">
                            <canvas id="fuelChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </template>

                <!-- Fuel Records Table -->
                <template x-if="fuelRecords.length > 0">
                    <table class="pf-v5-c-table pf-m-grid-md">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Hours</th>
                                <th>Qty (gal)</th>
                                <th>Level After</th>
                                <th>Type</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="record in fuelRecords" :key="record.id">
                                <tr>
                                    <td x-text="formatDate(record.date)"></td>
                                    <td x-text="formatHours(record.flight_hours)"></td>
                                    <td x-text="record.quantity_added"></td>
                                    <td x-text="record.level_after || '-'"></td>
                                    <td x-text="record.fuel_type || '-'"></td>
                                    <td x-text="record.notes || '-'"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </template>
            </div>
        </div>

        <!-- Documents Tab -->
        <div x-show="activeTab === 'documents'" class="pf-v5-c-page__main-section">
            <!-- Header with action buttons -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Documents</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="pf-v5-c-button pf-m-secondary" @click="openCollectionModal()">
                        <i class="fas fa-folder-plus"></i> Add Collection
                    </button>
                    <button class="pf-v5-c-button pf-m-primary" @click="openDocumentModal()">
                        <i class="fas fa-plus"></i> Add Document
                    </button>
                </div>
            </div>

            <!-- Loading State for Documents -->
            <div x-show="documentsLoading" class="pf-v5-c-empty-state">
                <div class="pf-v5-c-empty-state__content">
                    <div class="loading-spinner" style="width: 2rem; height: 2rem;"></div>
                    <h2 class="pf-v5-c-title pf-m-lg">Loading documents...</h2>
                </div>
            </div>

            <!-- Documents Content -->
            <div x-show="!documentsLoading" x-cloak>
                <!-- Empty State -->
                <template x-if="documentCollections.length === 0 && uncollectedDocuments.length === 0">
                    <div class="pf-v5-c-empty-state">
                        <div class="pf-v5-c-empty-state__content">
                            <i class="fas fa-folder-open" style="font-size: 3rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                            <h2 class="pf-v5-c-title pf-m-lg">No documents</h2>
                            <div class="pf-v5-c-empty-state__body">
                                No documents have been uploaded for this aircraft yet.
                            </div>
                            <div class="pf-v5-c-empty-state__primary" style="margin-top: 1rem;">
                                <button class="pf-v5-c-button pf-m-secondary" @click="openCollectionModal()">
                                    <i class="fas fa-folder-plus"></i> Add Collection
                                </button>
                                <button class="pf-v5-c-button pf-m-primary" @click="openDocumentModal()" style="margin-left: 0.5rem;">
                                    <i class="fas fa-plus"></i> Add Document
                                </button>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Document Collections -->
                <div class="pf-v5-l-stack pf-m-gutter" x-show="documentCollections.length > 0 || uncollectedDocuments.length > 0">
                    <!-- Collections -->
                    <template x-for="collection in documentCollections" :key="collection.id">
                        <div class="pf-v5-c-card">
                            <div class="pf-v5-c-card__header">
                                <div class="pf-v5-c-card__header-main">
                                    <div class="pf-v5-c-card__title">
                                        <h2 x-text="collection.name"></h2>
                                    </div>
                                </div>
                                <div class="pf-v5-c-card__actions" style="display: flex; align-items: center; gap: 0.25rem;">
                                    <button class="pf-v5-c-button pf-m-plain" @click="editCollection(collection)" title="Edit collection">
                                        <i class="fas fa-pencil-alt"></i>
                                    </button>
                                    <button class="pf-v5-c-button pf-m-plain pf-m-danger" @click="deleteCollection(collection)" title="Delete collection">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    <span class="pf-v5-c-label pf-m-blue">
                                        <span x-text="collection.document_count"></span> pages
                                    </span>
                                </div>
                            </div>
                            <template x-if="collection.description">
                                <div class="pf-v5-c-card__body">
                                    <p x-text="collection.description" style="color: var(--pf-v5-global--Color--200);"></p>
                                </div>
                            </template>
                            <div class="pf-v5-c-card__body">
                                <div class="document-grid">
                                    <template x-for="doc in collection.documents" :key="doc.id">
                                        <div class="document-item" style="position: relative;" @click="openDocumentViewer(doc, collection.name)">
                                            <div class="document-item-actions" style="position: absolute; top: 0.25rem; right: 0.25rem; display: flex; gap: 0.125rem; z-index: 2;">
                                                <button class="pf-v5-c-button pf-m-plain" style="padding: 0.25rem; font-size: 0.75rem;" @click="editDocument(doc, $event)" title="Edit document">
                                                    <i class="fas fa-pencil-alt"></i>
                                                </button>
                                                <button class="pf-v5-c-button pf-m-plain pf-m-danger" style="padding: 0.25rem; font-size: 0.75rem;" @click="deleteDocument(doc, $event)" title="Delete document">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                            <div class="document-thumbnail">
                                                <template x-if="doc.images && doc.images.length > 0 && getFileType(doc.images[0].image) === 'image'">
                                                    <img :src="doc.images[0].image" :alt="doc.name">
                                                </template>
                                                <template x-if="doc.images && doc.images.length > 0 && getFileType(doc.images[0].image) !== 'image'">
                                                    <div class="document-placeholder">
                                                        <i :class="getFileIcon(doc.images[0].image)" style="color: var(--pf-v5-global--danger-color--100);"></i>
                                                    </div>
                                                </template>
                                                <template x-if="!doc.images || doc.images.length === 0">
                                                    <div class="document-placeholder">
                                                        <i class="fas fa-file-alt"></i>
                                                    </div>
                                                </template>
                                            </div>
                                            <div class="document-info">
                                                <span class="document-name" x-text="doc.name"></span>
                                                <span class="document-type" x-text="doc.doc_type_display"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Uncollected Documents -->
                    <template x-if="uncollectedDocuments.length > 0">
                        <div class="pf-v5-c-card">
                            <div class="pf-v5-c-card__header">
                                <div class="pf-v5-c-card__header-main">
                                    <div class="pf-v5-c-card__title">
                                        <h2>Other Documents</h2>
                                    </div>
                                </div>
                                <div class="pf-v5-c-card__actions">
                                    <span class="pf-v5-c-label pf-m-grey">
                                        <span x-text="uncollectedDocuments.length"></span> documents
                                    </span>
                                </div>
                            </div>
                            <div class="pf-v5-c-card__body">
                                <div class="document-grid">
                                    <template x-for="doc in uncollectedDocuments" :key="doc.id">
                                        <div class="document-item" style="position: relative;" @click="openDocumentViewer(doc, 'Other Documents')">
                                            <div class="document-item-actions" style="position: absolute; top: 0.25rem; right: 0.25rem; display: flex; gap: 0.125rem; z-index: 2;">
                                                <button class="pf-v5-c-button pf-m-plain" style="padding: 0.25rem; font-size: 0.75rem;" @click="editDocument(doc, $event)" title="Edit document">
                                                    <i class="fas fa-pencil-alt"></i>
                                                </button>
                                                <button class="pf-v5-c-button pf-m-plain pf-m-danger" style="padding: 0.25rem; font-size: 0.75rem;" @click="deleteDocument(doc, $event)" title="Delete document">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                            <div class="document-thumbnail">
                                                <template x-if="doc.images && doc.images.length > 0 && getFileType(doc.images[0].image) === 'image'">
                                                    <img :src="doc.images[0].image" :alt="doc.name">
                                                </template>
                                                <template x-if="doc.images && doc.images.length > 0 && getFileType(doc.images[0].image) !== 'image'">
                                                    <div class="document-placeholder">
                                                        <i :class="getFileIcon(doc.images[0].image)" style="color: var(--pf-v5-global--danger-color--100);"></i>
                                                    </div>
                                                </template>
                                                <template x-if="!doc.images || doc.images.length === 0">
                                                    <div class="document-placeholder">
                                                        <i class="fas fa-file-alt"></i>
                                                    </div>
                                                </template>
                                            </div>
                                            <div class="document-info">
                                                <span class="document-name" x-text="doc.name"></span>
                                                <span class="document-type" x-text="doc.doc_type_display"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Logbook Entry Modal -->
    <div class="pf-v5-c-backdrop" x-show="logbookModalOpen" x-cloak @click.self="closeLogbookModal()" style="z-index: 1100;">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-lg" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeLogbookModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingLogEntry ? 'Edit Logbook Entry' : 'New Logbook Entry'"></h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitLogEntry" class="pf-v5-c-form">
                        <!-- Date / Hours row -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="log-date">
                                    <span class="pf-v5-c-form__label-text">Date</span>
                                    <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="log-date" class="pf-v5-c-form-control" type="date" x-model="logbookForm.date" required>
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="log-hours">
                                    <span class="pf-v5-c-form__label-text">Aircraft Hours</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="log-hours" class="pf-v5-c-form-control" type="number" step="0.1" min="0" x-model="logbookForm.aircraft_hours_at_entry" placeholder="e.g. 1234.5">
                                </div>
                            </div>
                        </div>

                        <!-- Entry Type / Log Type row -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="log-entry-type">
                                    <span class="pf-v5-c-form__label-text">Entry Type</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <select id="log-entry-type" class="pf-v5-c-form-control" x-model="logbookForm.entry_type">
                                        <option value="MAINTENANCE">Maintenance</option>
                                        <option value="INSPECTION">Inspection</option>
                                        <option value="FLIGHT">Flight</option>
                                        <option value="HOURS_UPDATE">Hours Update</option>
                                        <option value="OTHER">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="log-type">
                                    <span class="pf-v5-c-form__label-text">Log Book</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <select id="log-type" class="pf-v5-c-form-control" x-model="logbookForm.log_type">
                                        <option value="AC">Airframe</option>
                                        <option value="ENG">Engine</option>
                                        <option value="PROP">Propeller</option>
                                        <option value="OTHER">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Entry Text -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="log-text">
                                <span class="pf-v5-c-form__label-text">Entry Description</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="log-text" class="pf-v5-c-form-control" rows="4" x-model="logbookForm.text" required placeholder="Describe the maintenance performed, inspection completed, etc."></textarea>
                            </div>
                        </div>

                        <!-- Signoff row -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="log-signoff-person">
                                    <span class="pf-v5-c-form__label-text">Signed Off By</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="log-signoff-person" class="pf-v5-c-form-control" type="text" x-model="logbookForm.signoff_person" placeholder="Mechanic name / certificate #">
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="log-signoff-location">
                                    <span class="pf-v5-c-form__label-text">Location</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="log-signoff-location" class="pf-v5-c-form-control" type="text" x-model="logbookForm.signoff_location" placeholder="Airport / facility">
                                </div>
                            </div>
                        </div>

                        <!-- Attach Images (new entries only) -->
                        <template x-if="!editingLogEntry">
                            <div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="log-images">
                                        <span class="pf-v5-c-form__label-text">Attach Images / Documents</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="log-images" class="pf-v5-c-form-control" type="file" multiple
                                               accept=".jpg,.jpeg,.png,.gif,.webp,.bmp,.tiff,.pdf,.txt"
                                               @change="onLogbookFilesSelected($event)">
                                        <p style="font-size: 0.8em; color: var(--pf-v5-global--Color--200); margin-top: 0.25rem;">
                                            Files are uploaded as a new document linked to this entry. Accepted: images, PDF, TXT.
                                        </p>
                                        <template x-if="logbookImageFiles.length > 0">
                                            <p style="font-size: 0.85em; margin-top: 0.25rem;">
                                                <i class="fas fa-paperclip"></i>
                                                <span x-text="logbookImageFiles.length"></span> file(s) selected
                                            </p>
                                        </template>
                                    </div>
                                </div>
                                <template x-if="logbookImageFiles.length > 0">
                                    <div class="pf-v5-c-form__group">
                                        <label class="pf-v5-c-form__label" for="log-collection">
                                            <span class="pf-v5-c-form__label-text">Document Collection</span>
                                        </label>
                                        <div class="pf-v5-c-form__group-control">
                                            <select id="log-collection" class="pf-v5-c-form-control" x-model="logbookForm.document_collection">
                                                <option value=""> No collection (uncollected) </option>
                                                <template x-for="col in aircraftCollections" :key="col.id">
                                                    <option :value="col.id" x-text="col.name"></option>
                                                </template>
                                            </select>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Link to AD compliance (new entries only) -->
                        <template x-if="!editingLogEntry && applicableAds.length > 0">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="log-link-ad">
                                    <span class="pf-v5-c-form__label-text">Record AD Compliance</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <select id="log-link-ad" class="pf-v5-c-form-control" x-model="logbookForm.link_ad_id">
                                        <option value=""> None </option>
                                        <template x-for="ad in applicableAds" :key="ad.id">
                                            <option :value="ad.id" x-text="ad.name + '  ' + ad.short_description"></option>
                                        </template>
                                    </select>
                                    <p style="font-size: 0.8em; color: var(--pf-v5-global--Color--200); margin-top: 0.25rem;">
                                        Selecting an AD will create a compliance record linked to this logbook entry.
                                    </p>
                                </div>
                            </div>
                        </template>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" type="button" @click="submitLogEntry()" :disabled="logbookSubmitting">
                        <span x-show="!logbookSubmitting" x-text="editingLogEntry ? 'Save Changes' : 'Create Entry'"></span>
                        <span x-show="logbookSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" type="button" @click="closeLogbookModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Compliance History Modal -->
    <div class="pf-v5-c-backdrop" x-show="complianceHistoryOpen" x-cloak @click.self="closeComplianceHistory()" style="z-index: 1000;">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-lg" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeComplianceHistory()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title">
                        Compliance History
                        <template x-if="selectedAdForHistory">
                            <span style="font-weight: normal; font-size: 0.9em;">  <span x-text="selectedAdForHistory.name"></span></span>
                        </template>
                    </h1>
                    <template x-if="selectedAdForHistory?.short_description">
                        <div class="pf-v5-c-modal-box__description" x-text="selectedAdForHistory.short_description"></div>
                    </template>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <!-- Loading -->
                    <div x-show="complianceHistoryLoading" style="text-align: center; padding: 2rem;">
                        <div class="loading-spinner" style="width: 2rem; height: 2rem; margin: 0 auto;"></div>
                        <p style="margin-top: 0.5rem; color: var(--pf-v5-global--Color--200);">Loading history...</p>
                    </div>

                    <!-- Empty -->
                    <template x-if="!complianceHistoryLoading && complianceHistory.length === 0">
                        <div class="pf-v5-c-empty-state">
                            <div class="pf-v5-c-empty-state__content">
                                <i class="fas fa-clipboard" style="font-size: 2.5rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                                <h2 class="pf-v5-c-title pf-m-md">No compliance records</h2>
                                <div class="pf-v5-c-empty-state__body">
                                    No compliance has been recorded for this AD on this aircraft.
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Compliance records table -->
                    <template x-if="!complianceHistoryLoading && complianceHistory.length > 0">
                        <table class="pf-v5-c-table pf-m-grid-md">
                            <thead>
                                <tr>
                                    <th>Date Complied</th>
                                    <th>Aircraft Hours</th>
                                    <th>Notes</th>
                                    <th>Permanent</th>
                                    <th>Next Due (hrs)</th>
                                    <th>Logbook Entry</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="record in complianceHistory" :key="record.id">
                                    <tr>
                                        <td x-text="formatDate(record.date_complied)"></td>
                                        <td>
                                            <template x-if="record.aircraft_hours_at_compliance">
                                                <span x-text="formatHours(record.aircraft_hours_at_compliance)"></span>
                                            </template>
                                            <template x-if="!record.aircraft_hours_at_compliance">
                                                <span></span>
                                            </template>
                                        </td>
                                        <td x-text="record.compliance_notes || ''"></td>
                                        <td>
                                            <template x-if="record.permanent">
                                                <span class="pf-v5-c-label pf-m-green pf-m-compact">Yes</span>
                                            </template>
                                            <template x-if="!record.permanent">
                                                <span>No</span>
                                            </template>
                                        </td>
                                        <td>
                                            <template x-if="record.next_due_at_time && record.next_due_at_time > 0">
                                                <span x-text="formatHours(record.next_due_at_time) + ' hrs'"></span>
                                            </template>
                                            <template x-if="!record.next_due_at_time || record.next_due_at_time == 0">
                                                <span></span>
                                            </template>
                                        </td>
                                        <td>
                                            <template x-if="record.logbook_entry">
                                                <button class="pf-v5-c-button pf-m-link pf-m-inline"
                                                        @click="viewLogEntryFromCompliance(record.logbook_entry)">
                                                    <i class="fas fa-book-open"></i> View
                                                </button>
                                            </template>
                                            <template x-if="!record.logbook_entry">
                                                <span style="color: var(--pf-v5-global--Color--200);"></span>
                                            </template>
                                        </td>
                                        <td style="white-space: nowrap;">
                                            <button class="pf-v5-c-button pf-m-plain" title="Edit" @click="openEditComplianceModal(record)">
                                                <i class="fas fa-pencil-alt"></i>
                                            </button>
                                            <button class="pf-v5-c-button pf-m-plain" title="Delete" style="color: var(--pf-v5-global--danger-color--100);" @click="deleteComplianceRecord(record)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </template>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" type="button" @click="openComplianceModal(selectedAdForHistory); closeComplianceHistory()">
                        <i class="fas fa-plus"></i> Record New Compliance
                    </button>
                    <button class="pf-v5-c-button pf-m-link" type="button" @click="closeComplianceHistory()">Close</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Logbook Entry Detail Modal (from compliance history / inspection history) -->
    <div class="pf-v5-c-backdrop" x-show="logEntryDetailOpen" x-cloak @click.self="closeLogEntryDetail()" style="z-index: 1200;">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop style="max-height: 80vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeLogEntryDetail()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title">Logbook Entry</h1>
                    <template x-if="logEntryDetail">
                        <div class="pf-v5-c-modal-box__description">
                            <span x-text="formatDate(logEntryDetail.date)"></span>
                            <span class="pf-v5-c-label pf-m-blue pf-m-compact" style="margin-left: 0.5rem;" x-text="logEntryDetail.entry_type || logEntryDetail.log_type"></span>
                        </div>
                    </template>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <div x-show="logEntryDetailLoading" style="text-align: center; padding: 2rem;">
                        <div class="loading-spinner" style="width: 2rem; height: 2rem; margin: 0 auto;"></div>
                    </div>

                    <template x-if="!logEntryDetailLoading && logEntryDetail">
                        <dl class="pf-v5-c-description-list">
                            <div class="pf-v5-c-description-list__group">
                                <dt class="pf-v5-c-description-list__term">Description</dt>
                                <dd class="pf-v5-c-description-list__description" x-text="logEntryDetail.text"></dd>
                            </div>
                            <template x-if="logEntryDetail.aircraft_hours_at_entry">
                                <div class="pf-v5-c-description-list__group">
                                    <dt class="pf-v5-c-description-list__term">Aircraft Hours</dt>
                                    <dd class="pf-v5-c-description-list__description" x-text="formatHours(logEntryDetail.aircraft_hours_at_entry)"></dd>
                                </div>
                            </template>
                            <template x-if="logEntryDetail.signoff_person">
                                <div class="pf-v5-c-description-list__group">
                                    <dt class="pf-v5-c-description-list__term">Signed By</dt>
                                    <dd class="pf-v5-c-description-list__description">
                                        <span x-text="logEntryDetail.signoff_person"></span>
                                        <template x-if="logEntryDetail.signoff_location">
                                            <span> at <span x-text="logEntryDetail.signoff_location"></span></span>
                                        </template>
                                    </dd>
                                </div>
                            </template>
                            <template x-if="logEntryDetail.log_image">
                                <div class="pf-v5-c-description-list__group">
                                    <dt class="pf-v5-c-description-list__term">Attached Document</dt>
                                    <dd class="pf-v5-c-description-list__description">
                                        <button class="pf-v5-c-button pf-m-link pf-m-inline" @click="viewLogEntryDocument(logEntryDetail)">
                                            <i class="fas fa-images"></i> View images
                                        </button>
                                    </dd>
                                </div>
                            </template>
                        </dl>
                    </template>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-link" type="button" @click="closeLogEntryDetail()">Close</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Document Viewer Modal -->
    <div class="pf-v5-c-backdrop" x-show="viewerOpen" x-cloak @click.self="closeDocumentViewer()" style="z-index: 1300;">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-lg document-viewer-modal" @click.stop>
                <div style="position: absolute; top: 1rem; right: 1rem; z-index: 10; display: flex; gap: 0.25rem;">
                    <template x-if="viewerDocument?.images && viewerDocument.images.length > 0">
                        <a :href="viewerDocument.images[viewerImageIndex]?.image" class="pf-v5-c-button pf-m-plain" download target="_blank" title="Download file">
                            <i class="fas fa-download"></i>
                        </a>
                    </template>
                    <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeDocumentViewer()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="viewerDocument?.name"></h1>
                    <div class="pf-v5-c-modal-box__description">
                        <span x-text="viewerCollectionName"></span>
                        <span class="pf-v5-c-label pf-m-blue pf-m-compact" style="margin-left: 0.5rem;" x-text="viewerDocument?.doc_type_display"></span>
                    </div>
                </header>

                <div class="pf-v5-c-modal-box__body document-viewer-body">
                    <template x-if="viewerDocument?.description">
                        <p style="margin-bottom: 1rem; color: var(--pf-v5-global--Color--200);" x-text="viewerDocument.description"></p>
                    </template>

                    <!-- File Navigation -->
                    <template x-if="viewerDocument?.images && viewerDocument.images.length > 0">
                        <div class="document-viewer-images">
                            <!-- File Counter -->
                            <div class="image-counter" x-show="viewerDocument.images.length > 1">
                                <span x-text="viewerImageIndex + 1"></span> / <span x-text="viewerDocument.images.length"></span>
                            </div>

                            <!-- Main Content Area -->
                            <div class="viewer-image-container">
                                <button class="nav-button nav-prev" @click="prevImage()" x-show="viewerDocument.images.length > 1 && viewerImageIndex > 0">
                                    <i class="fas fa-chevron-left"></i>
                                </button>

                                <!-- Image file -->
                                <template x-if="getFileType(viewerDocument.images[viewerImageIndex]?.image) === 'image'">
                                    <img :src="viewerDocument.images[viewerImageIndex]?.image" :alt="viewerDocument.name" class="viewer-image">
                                </template>

                                <!-- PDF file -->
                                <template x-if="getFileType(viewerDocument.images[viewerImageIndex]?.image) === 'pdf'">
                                    <iframe :src="viewerDocument.images[viewerImageIndex]?.image" style="width: 100%; height: 70vh; border: 1px solid var(--pf-v5-global--BorderColor--100); border-radius: 4px;"></iframe>
                                </template>

                                <!-- Text or other file -->
                                <template x-if="getFileType(viewerDocument.images[viewerImageIndex]?.image) !== 'image' && getFileType(viewerDocument.images[viewerImageIndex]?.image) !== 'pdf'">
                                    <div style="text-align: center; padding: 2rem;">
                                        <i :class="getFileIcon(viewerDocument.images[viewerImageIndex]?.image)" style="font-size: 4rem; color: var(--pf-v5-global--Color--200); margin-bottom: 1rem;"></i>
                                        <p style="color: var(--pf-v5-global--Color--200);">This file cannot be previewed. Use the download button above.</p>
                                    </div>
                                </template>

                                <button class="nav-button nav-next" @click="nextImage()" x-show="viewerDocument.images.length > 1 && viewerImageIndex < viewerDocument.images.length - 1">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>

                            <!-- File Notes -->
                            <template x-if="viewerDocument.images[viewerImageIndex]?.notes">
                                <p class="image-notes" x-text="viewerDocument.images[viewerImageIndex].notes"></p>
                            </template>

                            <!-- Thumbnail Strip -->
                            <div class="thumbnail-strip" x-show="viewerDocument.images.length > 1">
                                <template x-for="(img, idx) in viewerDocument.images" :key="img.id">
                                    <div class="thumbnail"
                                         :class="{ 'active': idx === viewerImageIndex }"
                                         @click="viewerImageIndex = idx">
                                        <template x-if="getFileType(img.image) === 'image'">
                                            <img :src="img.image" :alt="`Page ${idx + 1}`">
                                        </template>
                                        <template x-if="getFileType(img.image) !== 'image'">
                                            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--pf-v5-global--BackgroundColor--200);">
                                                <i :class="getFileIcon(img.image)" style="font-size: 1.25rem; color: var(--pf-v5-global--Color--200);"></i>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>

                    <template x-if="!viewerDocument?.images || viewerDocument.images.length === 0">
                        <div class="pf-v5-c-empty-state">
                            <div class="pf-v5-c-empty-state__content">
                                <i class="fas fa-file" style="font-size: 3rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                                <h2 class="pf-v5-c-title pf-m-lg">No files</h2>
                                <div class="pf-v5-c-empty-state__body">
                                    This document has no attached files.
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Component Modal -->
    <div class="pf-v5-c-backdrop" x-show="componentModalOpen" x-cloak @click.self="closeComponentModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-lg" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeComponentModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingComponent ? 'Edit Component' : 'Add Component'"></h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitComponent" class="pf-v5-c-form">
                        <!-- Component Type -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="comp-type">
                                <span class="pf-v5-c-form__label-text">Component Type</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <select id="comp-type" class="pf-v5-c-form-control" x-model="componentForm.component_type" required>
                                    <option value="">-- Select type --</option>
                                    <template x-for="ct in componentTypes" :key="ct.id">
                                        <option :value="ct.id" x-text="ct.name"></option>
                                    </template>
                                </select>
                            </div>
                        </div>

                        <!-- Parent Component -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="comp-parent">
                                <span class="pf-v5-c-form__label-text">Parent Component</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <select id="comp-parent" class="pf-v5-c-form-control" x-model="componentForm.parent_component">
                                    <option value="">-- None (top-level) --</option>
                                    <template x-for="comp in getParentOptions(editingComponent?.id)" :key="comp.id">
                                        <option :value="comp.id" x-text="getComponentLabel(comp)"></option>
                                    </template>
                                </select>
                            </div>
                        </div>

                        <!-- Manufacturer / Model row -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-manufacturer">
                                    <span class="pf-v5-c-form__label-text">Manufacturer</span>
                                    <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="comp-manufacturer" class="pf-v5-c-form-control" type="text" x-model="componentForm.manufacturer" required>
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-model">
                                    <span class="pf-v5-c-form__label-text">Model</span>
                                    <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="comp-model" class="pf-v5-c-form-control" type="text" x-model="componentForm.model" required>
                                </div>
                            </div>
                        </div>

                        <!-- Serial Number / Install Location row -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-serial">
                                    <span class="pf-v5-c-form__label-text">Serial Number</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="comp-serial" class="pf-v5-c-form-control" type="text" x-model="componentForm.serial_number">
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-location">
                                    <span class="pf-v5-c-form__label-text">Install Location</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="comp-location" class="pf-v5-c-form-control" type="text" x-model="componentForm.install_location">
                                </div>
                            </div>
                        </div>

                        <!-- Status / Date In Service row -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-status">
                                    <span class="pf-v5-c-form__label-text">Status</span>
                                    <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <select id="comp-status" class="pf-v5-c-form-control" x-model="componentForm.status" required>
                                        <option value="IN-USE">In Service</option>
                                        <option value="SPARE">Spare Part</option>
                                        <option value="DISPOSED">Disposed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-date-in-service">
                                    <span class="pf-v5-c-form__label-text">Date In Service</span>
                                    <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="comp-date-in-service" class="pf-v5-c-form-control" type="date" x-model="componentForm.date_in_service" required>
                                </div>
                            </div>
                        </div>

                        <!-- Hours row -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-hours-in-service">
                                    <span class="pf-v5-c-form__label-text">Hours In Service</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="comp-hours-in-service" class="pf-v5-c-form-control" type="number" step="0.1" min="0" x-model="componentForm.hours_in_service">
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-hours-since-overhaul">
                                    <span class="pf-v5-c-form__label-text">Hours Since Overhaul</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="comp-hours-since-overhaul" class="pf-v5-c-form-control" type="number" step="0.1" min="0" x-model="componentForm.hours_since_overhaul">
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="comp-overhaul-date">
                                    <span class="pf-v5-c-form__label-text">Overhaul Date</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input id="comp-overhaul-date" class="pf-v5-c-form-control" type="date" x-model="componentForm.overhaul_date">
                                </div>
                            </div>
                        </div>

                        <!-- Tracking Flags -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label">
                                <span class="pf-v5-c-form__label-text">Tracking</span>
                            </label>
                            <div class="pf-v5-c-form__group-control" style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" x-model="componentForm.tbo_critical"> TBO Critical
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" x-model="componentForm.inspection_critical"> Inspection Critical
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" x-model="componentForm.replacement_critical"> Replacement Critical
                                </label>
                            </div>
                        </div>

                        <!-- TBO Intervals (shown when tbo_critical) -->
                        <template x-if="componentForm.tbo_critical">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="comp-tbo-hours">
                                        <span class="pf-v5-c-form__label-text">TBO Hours</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="comp-tbo-hours" class="pf-v5-c-form-control" type="number" min="0" x-model="componentForm.tbo_hours">
                                    </div>
                                </div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="comp-tbo-days">
                                        <span class="pf-v5-c-form__label-text">TBO Days</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="comp-tbo-days" class="pf-v5-c-form-control" type="number" min="0" x-model="componentForm.tbo_days">
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Inspection Intervals (shown when inspection_critical) -->
                        <template x-if="componentForm.inspection_critical">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="comp-inspection-hours">
                                        <span class="pf-v5-c-form__label-text">Inspection Hours</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="comp-inspection-hours" class="pf-v5-c-form-control" type="number" min="0" x-model="componentForm.inspection_hours">
                                    </div>
                                </div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="comp-inspection-days">
                                        <span class="pf-v5-c-form__label-text">Inspection Days</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="comp-inspection-days" class="pf-v5-c-form-control" type="number" min="0" x-model="componentForm.inspection_days">
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Replacement Intervals (shown when replacement_critical) -->
                        <template x-if="componentForm.replacement_critical">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="comp-replacement-hours">
                                        <span class="pf-v5-c-form__label-text">Replacement Hours</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="comp-replacement-hours" class="pf-v5-c-form-control" type="number" min="0" x-model="componentForm.replacement_hours">
                                    </div>
                                </div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="comp-replacement-days">
                                        <span class="pf-v5-c-form__label-text">Replacement Days</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="comp-replacement-days" class="pf-v5-c-form-control" type="number" min="0" x-model="componentForm.replacement_days">
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Notes -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="comp-notes">
                                <span class="pf-v5-c-form__label-text">Notes</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="comp-notes" class="pf-v5-c-form-control" rows="2" x-model="componentForm.notes" placeholder="Additional notes..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitComponent" :disabled="componentSubmitting">
                        <span x-show="!componentSubmitting" x-text="editingComponent ? 'Save Changes' : 'Add Component'"></span>
                        <span x-show="componentSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeComponentModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Squawk Modal -->
    <div class="pf-v5-c-backdrop" x-show="squawkModalOpen" x-cloak @click.self="closeSquawkModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop>
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeSquawkModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingSquawk ? 'Edit Squawk' : 'New Squawk'"></h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitSquawk" class="pf-v5-c-form">
                        <!-- Priority -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="squawk-priority">
                                <span class="pf-v5-c-form__label-text">Priority</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <select id="squawk-priority" class="pf-v5-c-form-control" x-model="squawkForm.priority" required>
                                    <option value="0">Ground Aircraft</option>
                                    <option value="1">Fix Soon</option>
                                    <option value="2">Fix at Next Inspection</option>
                                    <option value="3">Fix Eventually</option>
                                </select>
                            </div>
                        </div>

                        <!-- Component (Optional) -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="squawk-component">
                                <span class="pf-v5-c-form__label-text">Component (Optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <select id="squawk-component" class="pf-v5-c-form-control" x-model="squawkForm.component">
                                    <option value="">-- No specific component --</option>
                                    <template x-for="comp in components" :key="comp.id">
                                        <option :value="comp.id" x-text="getComponentTypeName(comp) + (comp.install_location ? ' (' + comp.install_location + ')' : '')"></option>
                                    </template>
                                </select>
                            </div>
                        </div>

                        <!-- Issue Reported -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="squawk-issue">
                                <span class="pf-v5-c-form__label-text">Issue Description</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="squawk-issue" class="pf-v5-c-form-control" rows="3" x-model="squawkForm.issue_reported" required placeholder="Describe the issue..."></textarea>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="squawk-notes">
                                <span class="pf-v5-c-form__label-text">Notes (Optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="squawk-notes" class="pf-v5-c-form-control" rows="2" x-model="squawkForm.notes" placeholder="Additional notes..."></textarea>
                            </div>
                        </div>

                        <!-- Grounding Warning -->
                        <template x-if="squawkForm.priority === '0' || squawkForm.priority === 0">
                            <div class="pf-v5-c-alert pf-m-warning pf-m-inline" role="alert">
                                <div class="pf-v5-c-alert__icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="pf-v5-c-alert__description">
                                    This squawk will ground the aircraft until resolved.
                                </div>
                            </div>
                        </template>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitSquawk" :disabled="squawkSubmitting">
                        <span x-show="!squawkSubmitting" x-text="editingSquawk ? 'Save Changes' : 'Create Squawk'"></span>
                        <span x-show="squawkSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeSquawkModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Note Modal -->
    <div class="pf-v5-c-backdrop" x-show="noteModalOpen" x-cloak @click.self="closeNoteModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop>
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeNoteModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingNote ? 'Edit Note' : 'Add Note'"></h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitNote" class="pf-v5-c-form">
                        <!-- Note Text -->
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="note-text">
                                <span class="pf-v5-c-form__label-text">Note</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="note-text" class="pf-v5-c-form-control" rows="5" x-model="noteForm.text" required placeholder="Enter your note..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitNote" :disabled="noteSubmitting">
                        <span x-show="!noteSubmitting" x-text="editingNote ? 'Save Changes' : 'Add Note'"></span>
                        <span x-show="noteSubmitting">Saving...</span>
                    </button>
                    <template x-if="editingNote">
                        <button class="pf-v5-c-button pf-m-danger" @click="deleteNote" :disabled="noteSubmitting">
                            Delete
                        </button>
                    </template>
                    <button class="pf-v5-c-button pf-m-link" @click="closeNoteModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- All Notes Modal -->
    <div class="pf-v5-c-backdrop" x-show="showAllNotes" x-cloak @click.self="showAllNotes = false">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-lg" @click.stop>
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="showAllNotes = false" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title">All Notes</h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <div class="notes-list notes-list-full">
                        <template x-for="note in aircraftNotes" :key="note.id">
                            <div class="note-item" @click="editNote(note); showAllNotes = false;">
                                <p class="note-text" x-text="note.text"></p>
                                <div class="note-meta">
                                    <span x-text="formatDate(note.added_timestamp)"></span>
                                    <template x-if="note.added_by_username">
                                        <span> - <span x-text="note.added_by_username"></span></span>
                                    </template>
                                    <template x-if="note.edited_timestamp">
                                        <span class="note-edited">(edited)</span>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="openNoteModal(); showAllNotes = false;">
                        <i class="fas fa-plus"></i> Add Note
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="showAllNotes = false">Close</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Oil Record Modal -->
    <div class="pf-v5-c-backdrop" x-show="oilModalOpen" x-cloak @click.self="closeOilModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop>
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeOilModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title">Add Oil Record</h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitOilRecord" class="pf-v5-c-form">
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="oil-date">
                                <span class="pf-v5-c-form__label-text">Date</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="date" id="oil-date" class="pf-v5-c-form-control" x-model="oilForm.date" required>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="oil-quantity">
                                <span class="pf-v5-c-form__label-text">Quantity Added (quarts)</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="number" step="0.25" min="0" id="oil-quantity" class="pf-v5-c-form-control" x-model="oilForm.quantity_added" required>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="oil-level">
                                <span class="pf-v5-c-form__label-text">Level After (quarts, optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="number" step="0.25" min="0" id="oil-level" class="pf-v5-c-form-control" x-model="oilForm.level_after">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="oil-hours">
                                <span class="pf-v5-c-form__label-text">Aircraft Hours</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="number" step="0.1" min="0" id="oil-hours" class="pf-v5-c-form-control" x-model="oilForm.flight_hours" :placeholder="formatHours(aircraft?.flight_time)">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="oil-type">
                                <span class="pf-v5-c-form__label-text">Oil Type (optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="text" id="oil-type" class="pf-v5-c-form-control" x-model="oilForm.oil_type" placeholder="e.g. Aeroshell W100">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="oil-notes">
                                <span class="pf-v5-c-form__label-text">Notes (optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="oil-notes" class="pf-v5-c-form-control" rows="2" x-model="oilForm.notes"></textarea>
                            </div>
                        </div>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitOilRecord" :disabled="oilSubmitting">
                        <span x-show="!oilSubmitting">Add Record</span>
                        <span x-show="oilSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeOilModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Add AD Modal -->
    <div class="pf-v5-c-backdrop" x-show="adModalOpen" x-cloak @click.self="closeAdModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeAdModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingAd ? 'Edit Airworthiness Directive' : 'Add Airworthiness Directive'"></h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <!-- Add existing AD - only show when creating new -->
                    <div class="pf-v5-c-form" style="margin-bottom: 1.5rem;" x-show="!editingAd">
                        <h3 style="margin-bottom: 0.5rem;">Add Existing AD</h3>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="existing-ad-select">
                                <span class="pf-v5-c-form__label-text">Select AD</span>
                            </label>
                            <div class="pf-v5-c-form__group-control" style="display: flex; gap: 0.5rem;">
                                <select id="existing-ad-select" class="pf-v5-c-form-control" x-model="selectedExistingAdId" style="flex: 1;">
                                    <option value="">-- Select an AD --</option>
                                    <template x-for="ad in availableAds" :key="ad.id">
                                        <option :value="ad.id" x-text="ad.name + ' - ' + ad.short_description"></option>
                                    </template>
                                </select>
                                <button class="pf-v5-c-button pf-m-primary" @click="addExistingAd()" :disabled="!selectedExistingAdId || adSubmitting">
                                    Add
                                </button>
                            </div>
                        </div>
                    </div>

                    <hr style="margin: 1rem 0; border-color: var(--pf-v5-global--BorderColor--100);" x-show="!editingAd">

                    <!-- Create new AD -->
                    <h3 style="margin-bottom: 0.5rem;" x-text="editingAd ? 'Edit AD Details' : 'Or Create New AD'"></h3>
                    <form @submit.prevent="createAndAddAd" class="pf-v5-c-form">
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="ad-name">
                                <span class="pf-v5-c-form__label-text">AD Name</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input id="ad-name" class="pf-v5-c-form-control" type="text" x-model="adForm.name" placeholder="e.g. AD 2024-01-05">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="ad-description">
                                <span class="pf-v5-c-form__label-text">Short Description</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input id="ad-description" class="pf-v5-c-form-control" type="text" x-model="adForm.short_description">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="ad-action">
                                <span class="pf-v5-c-form__label-text">Required Action</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="ad-action" class="pf-v5-c-form-control" rows="2" x-model="adForm.required_action"></textarea>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="ad-compliance-type">
                                <span class="pf-v5-c-form__label-text">Compliance Type</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <select id="ad-compliance-type" class="pf-v5-c-form-control" x-model="adForm.compliance_type">
                                    <option value="standard">Standard</option>
                                    <option value="conditional">Conditional (trigger-based)</option>
                                </select>
                            </div>
                        </div>
                        <template x-if="adForm.compliance_type === 'conditional'">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="ad-trigger-condition">
                                    <span class="pf-v5-c-form__label-text">Trigger Condition</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <textarea id="ad-trigger-condition" class="pf-v5-c-form-control" rows="2" x-model="adForm.trigger_condition" placeholder="e.g. Upon crankshaft removal from engine"></textarea>
                                </div>
                            </div>
                        </template>
                        <div class="pf-v5-c-form__group">
                            <div class="pf-v5-c-form__group-control">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" x-model="adForm.recurring"> Recurring
                                </label>
                            </div>
                        </div>
                        <template x-if="adForm.recurring">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="ad-recurring-hours">
                                        <span class="pf-v5-c-form__label-text">Hours</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="ad-recurring-hours" class="pf-v5-c-form-control" type="number" step="0.1" min="0" x-model="adForm.recurring_hours">
                                    </div>
                                </div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="ad-recurring-months">
                                        <span class="pf-v5-c-form__label-text">Months</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="ad-recurring-months" class="pf-v5-c-form-control" type="number" min="0" x-model="adForm.recurring_months">
                                    </div>
                                </div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="ad-recurring-days">
                                        <span class="pf-v5-c-form__label-text">Days</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input id="ad-recurring-days" class="pf-v5-c-form-control" type="number" min="0" x-model="adForm.recurring_days">
                                    </div>
                                </div>
                            </div>
                        </template>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary"
                            @click="editingAd ? updateAd() : createAndAddAd()"
                            :disabled="adSubmitting || !adForm.name || !adForm.short_description"
                            x-text="editingAd ? (adSubmitting ? 'Updating...' : 'Update AD') : (adSubmitting ? 'Creating...' : 'Create and Add to Aircraft')">
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeAdModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Record Compliance Modal -->
    <div class="pf-v5-c-backdrop" x-show="complianceModalOpen" x-cloak @click.self="closeComplianceModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeComplianceModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingComplianceRecord ? 'Edit Compliance Record' : 'Record AD Compliance'"></h1>
                    <template x-if="selectedAd">
                        <div class="pf-v5-c-modal-box__description" x-text="selectedAd.name + '  ' + selectedAd.short_description"></div>
                    </template>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitCompliance" class="pf-v5-c-form">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="compliance-date">
                                    <span class="pf-v5-c-form__label-text">Date Complied</span>
                                    <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input type="date" id="compliance-date" class="pf-v5-c-form-control" x-model="complianceForm.date_complied" required>
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="compliance-aircraft-hours">
                                    <span class="pf-v5-c-form__label-text">Aircraft Hours</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input type="number" step="0.1" min="0" id="compliance-aircraft-hours" class="pf-v5-c-form-control" x-model="complianceForm.aircraft_hours" placeholder="e.g. 1234.5">
                                </div>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="compliance-notes">
                                <span class="pf-v5-c-form__label-text">Compliance Notes</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="compliance-notes" class="pf-v5-c-form-control" rows="3" x-model="complianceForm.compliance_notes" required placeholder="Describe compliance action taken..."></textarea>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <div class="pf-v5-c-form__group-control">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" x-model="complianceForm.permanent"> Permanent (one-time compliance, no recurrence)
                                </label>
                            </div>
                        </div>
                        <template x-if="!complianceForm.permanent">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="compliance-next-due">
                                    <span class="pf-v5-c-form__label-text">Next Due At (aircraft hours)</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <input type="number" step="0.1" min="0" id="compliance-next-due" class="pf-v5-c-form-control" x-model="complianceForm.next_due_at_time" :placeholder="'Current: ' + formatHours(aircraft?.flight_time)">
                                </div>
                            </div>
                        </template>

                        <!-- Logbook entry section (edit only) -->
                        <template x-if="editingComplianceRecord">
                            <div class="pf-v5-c-form__group" style="border-top: 1px solid var(--pf-v5-global--BorderColor--100); padding-top: 1rem; margin-top: 0.5rem;">
                                <label class="pf-v5-c-form__label" for="compliance-logbook-entry">
                                    <span class="pf-v5-c-form__label-text">Logbook Entry</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <select id="compliance-logbook-entry" class="pf-v5-c-form-control" x-model="complianceForm.logbook_entry_id">
                                        <option value=""> None </option>
                                        <template x-for="entry in logbookEntries" :key="entry.id">
                                            <option :value="entry.id" x-text="logbookEntryLabel(entry)"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                        </template>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitCompliance" :disabled="complianceSubmitting">
                        <span x-show="!complianceSubmitting" x-text="editingComplianceRecord ? 'Save Changes' : 'Record Compliance'"></span>
                        <span x-show="complianceSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeComplianceModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Inspection History Modal -->
    <div class="pf-v5-c-backdrop" x-show="inspectionHistoryOpen" x-cloak @click.self="closeInspectionHistory()" style="z-index: 1000;">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-lg" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeInspectionHistory()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title">
                        <template x-if="selectedInspectionType">
                            <span x-text="selectedInspectionType.name + '  History'"></span>
                        </template>
                    </h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <!-- Loading -->
                    <div x-show="inspectionHistoryLoading" style="text-align: center; padding: 2rem;">
                        <div class="loading-spinner" style="width: 2rem; height: 2rem; margin: 0 auto;"></div>
                        <p style="margin-top: 0.5rem; color: var(--pf-v5-global--Color--200);">Loading history...</p>
                    </div>

                    <!-- Empty -->
                    <template x-if="!inspectionHistoryLoading && inspectionHistory.length === 0">
                        <div class="pf-v5-c-empty-state">
                            <div class="pf-v5-c-empty-state__content">
                                <i class="fas fa-clipboard" style="font-size: 2.5rem; color: var(--pf-v5-global--disabled-color--100);"></i>
                                <h2 class="pf-v5-c-title pf-m-md">No inspection records</h2>
                                <div class="pf-v5-c-empty-state__body">
                                    No records have been logged for this inspection type yet.
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Records table -->
                    <template x-if="!inspectionHistoryLoading && inspectionHistory.length > 0">
                        <table class="pf-v5-c-table pf-m-grid-md">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Aircraft Hours</th>
                                    <th>Logbook Entry</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="record in inspectionHistory" :key="record.id">
                                    <tr>
                                        <td x-text="formatDate(record.date)"></td>
                                        <td>
                                            <template x-if="record.aircraft_hours != null">
                                                <span x-text="formatHours(record.aircraft_hours)"></span>
                                            </template>
                                            <template x-if="record.aircraft_hours == null">
                                                <span style="color: var(--pf-v5-global--Color--200);"></span>
                                            </template>
                                        </td>
                                        <td>
                                            <template x-if="record.logbook_entry">
                                                <button class="pf-v5-c-button pf-m-link pf-m-inline"
                                                        @click="viewLogEntryFromCompliance(record.logbook_entry)">
                                                    <i class="fas fa-book-open"></i> View
                                                </button>
                                            </template>
                                            <template x-if="!record.logbook_entry">
                                                <span style="color: var(--pf-v5-global--Color--200);"></span>
                                            </template>
                                        </td>
                                        <td>
                                            <div style="display: flex; gap: 0.25rem;">
                                                <button class="pf-v5-c-button pf-m-plain"
                                                        @click="editInspectionRecord(record)"
                                                        title="Edit Record">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="pf-v5-c-button pf-m-plain pf-m-danger"
                                                        @click="deleteInspectionRecord(record)"
                                                        title="Delete Record">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </template>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="openInspectionModal(selectedInspectionType)">
                        <i class="fas fa-plus"></i> Record Inspection
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeInspectionHistory()">Close</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Record Inspection Modal -->
    <div class="pf-v5-c-backdrop" x-show="inspectionModalOpen" x-cloak @click.self="closeInspectionModal()" style="z-index: 1100;">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeInspectionModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title">
                        <template x-if="editingInspectionRecord">Edit Inspection Record</template>
                        <template x-if="!editingInspectionRecord">
                            <span>
                                Record Inspection
                                <template x-if="selectedInspectionType">
                                    <span> <span x-text="selectedInspectionType.name"></span></span>
                                </template>
                            </span>
                        </template>
                    </h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitInspection" class="pf-v5-c-form">
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="inspection-date">
                                <span class="pf-v5-c-form__label-text">Date Completed</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="date" id="inspection-date" class="pf-v5-c-form-control" x-model="inspectionForm.date" required>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="inspection-aircraft-hours">
                                <span class="pf-v5-c-form__label-text">Aircraft Hours</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="number" step="0.1" min="0" id="inspection-aircraft-hours" class="pf-v5-c-form-control"
                                       x-model="inspectionForm.aircraft_hours"
                                       :placeholder="formatHours(aircraft?.flight_time)">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="inspection-logbook-entry">
                                <span class="pf-v5-c-form__label-text">Logbook Entry (optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <select id="inspection-logbook-entry" class="pf-v5-c-form-control" x-model="inspectionForm.logbook_entry_id">
                                    <option value=""> None </option>
                                    <template x-for="entry in logbookEntries" :key="entry.id">
                                        <option :value="entry.id" x-text="logbookEntryLabel(entry)"></option>
                                    </template>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitInspection" :disabled="inspectionSubmitting">
                        <span x-show="!inspectionSubmitting" x-text="editingInspectionRecord ? 'Save Changes' : 'Record Inspection'"></span>
                        <span x-show="inspectionSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeInspectionModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Add / Edit Inspection Type Modal -->
    <div class="pf-v5-c-backdrop" x-show="inspectionTypeModalOpen" x-cloak @click.self="closeInspectionTypeModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeInspectionTypeModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingInspectionType ? 'Edit Inspection Type' : 'Add Inspection Type'"></h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <!-- Add existing or create new (only when creating) -->
                    <template x-if="!editingInspectionType">
                        <div style="margin-bottom: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label">
                                    <span class="pf-v5-c-form__label-text">Add Existing Type</span>
                                </label>
                                <div class="pf-v5-c-form__group-control" style="display: flex; gap: 0.5rem;">
                                    <select class="pf-v5-c-form-control" x-model="selectedExistingInspectionTypeId">
                                        <option value=""> Select existing </option>
                                        <template x-for="t in availableInspectionTypes" :key="t.id">
                                            <option :value="t.id" x-text="t.name"></option>
                                        </template>
                                    </select>
                                    <button class="pf-v5-c-button pf-m-secondary"
                                            @click="addExistingInspectionType()"
                                            :disabled="!selectedExistingInspectionTypeId || inspectionTypeSubmitting">
                                        Add
                                    </button>
                                </div>
                            </div>
                            <div style="text-align: center; margin: 1rem 0; color: var(--pf-v5-global--Color--200);"> or create new </div>
                        </div>
                    </template>

                    <form @submit.prevent="submitInspectionType" class="pf-v5-c-form">
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="itype-name">
                                <span class="pf-v5-c-form__label-text">Name</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="text" id="itype-name" class="pf-v5-c-form-control" x-model="inspectionTypeForm.name" required placeholder="e.g. Annual Inspection">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label">
                                <span class="pf-v5-c-form__label-text">Required</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <label class="pf-v5-c-check">
                                    <input type="checkbox" class="pf-v5-c-check__input" x-model="inspectionTypeForm.required">
                                    <span class="pf-v5-c-check__label">Required for airworthiness</span>
                                </label>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label">
                                <span class="pf-v5-c-form__label-text">Recurring</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <label class="pf-v5-c-check">
                                    <input type="checkbox" class="pf-v5-c-check__input" x-model="inspectionTypeForm.recurring">
                                    <span class="pf-v5-c-check__label">Repeats on a schedule</span>
                                </label>
                            </div>
                        </div>
                        <template x-if="inspectionTypeForm.recurring">
                            <div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="itype-hours">
                                        <span class="pf-v5-c-form__label-text">Recurring Hours (0 = not used)</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input type="number" step="0.1" min="0" id="itype-hours" class="pf-v5-c-form-control" x-model="inspectionTypeForm.recurring_hours">
                                    </div>
                                </div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="itype-months">
                                        <span class="pf-v5-c-form__label-text">Recurring Months (0 = not used)</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input type="number" min="0" id="itype-months" class="pf-v5-c-form-control" x-model="inspectionTypeForm.recurring_months">
                                    </div>
                                </div>
                                <div class="pf-v5-c-form__group">
                                    <label class="pf-v5-c-form__label" for="itype-days">
                                        <span class="pf-v5-c-form__label-text">Recurring Days (0 = not used)</span>
                                    </label>
                                    <div class="pf-v5-c-form__group-control">
                                        <input type="number" min="0" id="itype-days" class="pf-v5-c-form-control" x-model="inspectionTypeForm.recurring_days">
                                    </div>
                                </div>
                            </div>
                        </template>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitInspectionType" :disabled="inspectionTypeSubmitting">
                        <span x-show="!inspectionTypeSubmitting" x-text="editingInspectionType ? 'Save Changes' : 'Create & Add'"></span>
                        <span x-show="inspectionTypeSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeInspectionTypeModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Fuel Record Modal -->
    <div class="pf-v5-c-backdrop" x-show="fuelModalOpen" x-cloak @click.self="closeFuelModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop>
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeFuelModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title">Add Fuel Record</h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitFuelRecord" class="pf-v5-c-form">
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="fuel-date">
                                <span class="pf-v5-c-form__label-text">Date</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="date" id="fuel-date" class="pf-v5-c-form-control" x-model="fuelForm.date" required>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="fuel-quantity">
                                <span class="pf-v5-c-form__label-text">Quantity Added (gallons)</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="number" step="0.1" min="0" id="fuel-quantity" class="pf-v5-c-form-control" x-model="fuelForm.quantity_added" required>
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="fuel-level">
                                <span class="pf-v5-c-form__label-text">Level After (gallons, optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="number" step="0.1" min="0" id="fuel-level" class="pf-v5-c-form-control" x-model="fuelForm.level_after">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="fuel-hours">
                                <span class="pf-v5-c-form__label-text">Aircraft Hours</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="number" step="0.1" min="0" id="fuel-hours" class="pf-v5-c-form-control" x-model="fuelForm.flight_hours" :placeholder="formatHours(aircraft?.flight_time)">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="fuel-type">
                                <span class="pf-v5-c-form__label-text">Fuel Type (optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input type="text" id="fuel-type" class="pf-v5-c-form-control" x-model="fuelForm.fuel_type" placeholder="e.g. 100LL">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="fuel-notes">
                                <span class="pf-v5-c-form__label-text">Notes (optional)</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="fuel-notes" class="pf-v5-c-form-control" rows="2" x-model="fuelForm.notes"></textarea>
                            </div>
                        </div>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitFuelRecord" :disabled="fuelSubmitting">
                        <span x-show="!fuelSubmitting">Add Record</span>
                        <span x-show="fuelSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeFuelModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Collection Modal -->
    <div class="pf-v5-c-backdrop" x-show="collectionModalOpen" x-cloak @click.self="closeCollectionModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop>
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeCollectionModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingCollection ? 'Edit Collection' : 'Add Collection'"></h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitCollection" class="pf-v5-c-form">
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="collection-name">
                                <span class="pf-v5-c-form__label-text">Name</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input id="collection-name" class="pf-v5-c-form-control" type="text" x-model="collectionForm.name" required placeholder="e.g. Engine Logbook">
                            </div>
                        </div>
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="collection-description">
                                <span class="pf-v5-c-form__label-text">Description</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="collection-description" class="pf-v5-c-form-control" rows="3" x-model="collectionForm.description" placeholder="Optional description..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitCollection" :disabled="collectionSubmitting">
                        <span x-show="!collectionSubmitting" x-text="editingCollection ? 'Save Changes' : 'Create Collection'"></span>
                        <span x-show="collectionSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeCollectionModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Document Modal -->
    <div class="pf-v5-c-backdrop" x-show="documentModalOpen" x-cloak @click.self="closeDocumentModal()">
        <div class="pf-v5-l-bullseye">
            <div class="pf-v5-c-modal-box pf-m-md" @click.stop style="max-height: 90vh; overflow-y: auto;">
                <button class="pf-v5-c-button pf-m-plain" type="button" aria-label="Close" @click="closeDocumentModal()" style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>

                <header class="pf-v5-c-modal-box__header">
                    <h1 class="pf-v5-c-modal-box__title" x-text="editingDocument ? 'Edit Document' : 'Add Document'"></h1>
                </header>

                <div class="pf-v5-c-modal-box__body">
                    <form @submit.prevent="submitDocument" class="pf-v5-c-form">
                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="doc-name">
                                <span class="pf-v5-c-form__label-text">Name</span>
                                <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input id="doc-name" class="pf-v5-c-form-control" type="text" x-model="documentForm.name" required placeholder="e.g. Annual Inspection 2024">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="doc-type">
                                    <span class="pf-v5-c-form__label-text">Document Type</span>
                                    <span class="pf-v5-c-form__label-required" aria-hidden="true">*</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <select id="doc-type" class="pf-v5-c-form-control" x-model="documentForm.doc_type" required>
                                        <template x-for="dt in documentTypes" :key="dt.value">
                                            <option :value="dt.value" x-text="dt.label"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label" for="doc-collection">
                                    <span class="pf-v5-c-form__label-text">Collection</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <select id="doc-collection" class="pf-v5-c-form-control" x-model="documentForm.collection">
                                        <option value="">-- None --</option>
                                        <template x-for="col in documentCollections" :key="col.id">
                                            <option :value="col.id" x-text="col.name"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="doc-description">
                                <span class="pf-v5-c-form__label-text">Description</span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <textarea id="doc-description" class="pf-v5-c-form-control" rows="2" x-model="documentForm.description" placeholder="Optional description..."></textarea>
                            </div>
                        </div>

                        <!-- Existing images (edit mode) -->
                        <template x-if="editingDocument && editingDocument.images && editingDocument.images.length > 0">
                            <div class="pf-v5-c-form__group">
                                <label class="pf-v5-c-form__label">
                                    <span class="pf-v5-c-form__label-text">Existing Images</span>
                                </label>
                                <div class="pf-v5-c-form__group-control">
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                        <template x-for="img in editingDocument.images" :key="img.id">
                                            <div style="position: relative; width: 80px; height: 80px; border: 1px solid var(--pf-v5-global--BorderColor--100); border-radius: 4px; overflow: hidden;">
                                                <img :src="img.image" style="width: 100%; height: 100%; object-fit: cover;">
                                                <button type="button" class="pf-v5-c-button pf-m-plain" @click="deleteDocumentImage(img.id)"
                                                        style="position: absolute; top: 0; right: 0; padding: 0.125rem 0.25rem; background: rgba(0,0,0,0.6); color: white; font-size: 0.625rem; border-radius: 0 0 0 4px;"
                                                        title="Delete image">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <div class="pf-v5-c-form__group">
                            <label class="pf-v5-c-form__label" for="doc-images">
                                <span class="pf-v5-c-form__label-text" x-text="editingDocument ? 'Add More Images' : 'Images'"></span>
                            </label>
                            <div class="pf-v5-c-form__group-control">
                                <input id="doc-images" type="file" class="pf-v5-c-form-control" multiple accept="image/*,.pdf,.txt,.text" @change="onDocumentFilesSelected($event)">
                            </div>
                        </div>
                    </form>
                </div>

                <footer class="pf-v5-c-modal-box__footer">
                    <button class="pf-v5-c-button pf-m-primary" @click="submitDocument" :disabled="documentSubmitting">
                        <span x-show="!documentSubmitting" x-text="editingDocument ? 'Save Changes' : 'Create Document'"></span>
                        <span x-show="documentSubmitting">Saving...</span>
                    </button>
                    <button class="pf-v5-c-button pf-m-link" @click="closeDocumentModal()">Cancel</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Aircraft Modal -->
    {% include 'includes/aircraft_modal.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/aircraft-detail-components.js' %}"></script>
<script src="{% static 'js/aircraft-detail-squawks.js' %}"></script>
<script src="{% static 'js/aircraft-detail-notes.js' %}"></script>
<script src="{% static 'js/aircraft-detail-oil.js' %}"></script>
<script src="{% static 'js/aircraft-detail-fuel.js' %}"></script>
<script src="{% static 'js/aircraft-detail-logbook.js' %}"></script>
<script src="{% static 'js/aircraft-detail-ads.js' %}"></script>
<script src="{% static 'js/aircraft-detail-inspections.js' %}"></script>
<script src="{% static 'js/aircraft-detail-documents.js' %}"></script>
<script src="{% static 'js/aircraft-detail-events.js' %}"></script>
<script src="{% static 'js/aircraft-detail.js' %}"></script>
<script src="{% static 'js/aircraft-modal.js' %}"></script>
{% endblock %}
